# üìö –ì–∞–π–¥ –ø–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ createQueryStore

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ **createQueryStore** ‚Äî —ç—Ç–æ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–æ–≤. –û–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ **@qtpy/state-management-observable** –∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –æ–±–ª–µ–≥—á–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –∏ –∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º. –ù–∏–∂–µ –º—ã –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞–∑–±–µ—Ä—ë–º –∫–∞–∂–¥—ã–π –º–µ—Ç–æ–¥ —ç—Ç–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.

## ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:

- **@qtpy/state-management-observable**: –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞–∫–µ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —á–µ—Ä–µ–∑ observable-—Ö—Ä–∞–Ω–∏–ª–∏—â–∞.
- –¢–∏–ø—ã –∏–∑ **@qtpy/state-management-observable/types** –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ç–∏–ø—ã.

---

## üõ†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏ –∏—Ö –æ–ø–∏—Å–∞–Ω–∏–µ

### 1. **createQueryStore** üîÑ

–ú–µ—Ç–æ–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∑–∞–ø—Ä–æ—Å–æ–≤, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏ –º—É—Ç–∞—Ü–∏–π.

```typescript
createQueryStore<T extends object>(
  initial: T,
  middlewares: Middleware<T>[] = [],
  userConfig: Partial<QueryStoreConfig> = {}
)
```

**–ê—Ä–≥—É–º–µ–Ω—Ç—ã:**

- `initial`: –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (–æ–±—ä–µ–∫—Ç). üì¶
- `middlewares`: –ú–∞—Å—Å–∏–≤ middlewares –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è. üõ†Ô∏è
- `userConfig`: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ). ‚öôÔ∏è

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: –û–±—ä–µ–∫—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫—ç—à–∞ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏. üìö

---

### 2. **addErrorHandler** ‚ö†Ô∏è

–ú–µ—Ç–æ–¥ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –æ—à–∏–±–æ–∫.

```typescript
addErrorHandler<E = Error>(
  handler: ErrorHandler<T, E>,
  options: ErrorHandlerOptions = {}
)
```

**–ê—Ä–≥—É–º–µ–Ω—Ç—ã:**

- `handler`: –§—É–Ω–∫—Ü–∏—è-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–∫–∏. üö®
- `options`: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–ª–∞–≥, –Ω—É–∂–Ω–æ –ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –ø—Ä–æ–ø–∞–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É). ‚ö°

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```typescript
store.addErrorHandler(
  (error, context) => {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:", error);
  },
  { propagate: false }
);
```

---

### 3. **removeErrorHandler** üõë

–ú–µ—Ç–æ–¥ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –æ—à–∏–±–æ–∫.

```typescript
removeErrorHandler(handler: ErrorHandler<T>)
```

**–ê—Ä–≥—É–º–µ–Ω—Ç—ã:**

- `handler`: –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –æ—à–∏–±–∫–∏, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å. üóëÔ∏è

---

### 4. **cleanupCache** üßπ

–ú–µ—Ç–æ–¥ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞.

```typescript
cleanupCache();
```

**–û—á–∏—â–∞–µ—Ç** –≤—Å–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ –∫—ç—à–µ. üî•

---

### 5. **onInvalidate** üîÑ

–ú–µ—Ç–æ–¥ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–ª–±–µ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω –ø—Ä–∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫–ª—é—á—É.

```typescript
onInvalidate(cacheKey: CacheKey, callback: InvalidationCallback)
```

**–ê—Ä–≥—É–º–µ–Ω—Ç—ã:**

- `cacheKey`: –ö–ª—é—á –∫—ç—à–∞. üîë
- `callback`: –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–∞ –ø—Ä–∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏. üîÅ

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```typescript
store.onInvalidate("some-cache-key", () => {
  console.log("–ö—ç—à –±—ã–ª –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω");
});
```

---

### 6. **invalidate** ‚ùå

–ú–µ—Ç–æ–¥ –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –∫—ç—à–µ.

```typescript
invalidate(cacheKey: CacheKey)
```

**–ê—Ä–≥—É–º–µ–Ω—Ç:**

- `cacheKey`: –ö–ª—é—á –∫—ç—à–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å. üö´

---

### 7. **createMutation** üîÑ

–ú–µ—Ç–æ–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º—É—Ç–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é.

```typescript
createMutation<TInput, TOutput>(
  options: MutationOptions<TInput, TOutput>
): Mutation<TInput, TOutput>
```

**–ê—Ä–≥—É–º–µ–Ω—Ç—ã:**

- `options`: –û–±—ä–µ–∫—Ç —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –º—É—Ç–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞, —Ç–µ–≥–∏ –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏). üéØ

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```typescript
const mutation = store.createMutation({
  mutationFn: async (input) => {
    return await someApiCall(input);
  },
  invalidateTags: ["user-data"],
  onSuccess: (data) => console.log("–ú—É—Ç–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ", data),
});
```

---

### 8. **fetchDependent** ‚è≥

–ú–µ—Ç–æ–¥ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –æ—Ç –¥—Ä—É–≥–∏—Ö –ø—É—Ç–µ–π.

```typescript
fetchDependent<P extends Paths<T>>(
  key: string,
  fetchFn: (signal?: AbortSignal) => Promise<ExtractPathType<T, P>>,
  options: { dependsOn?: Paths<T>[]; signal?: AbortSignal } = {}
)
```

**–ê—Ä–≥—É–º–µ–Ω—Ç—ã:**

- `key`: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á –∑–∞–ø—Ä–æ—Å–∞. üîë
- `fetchFn`: –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å. üîÑ
- `options`: –û–ø—Ü–∏–∏, –≤–∫–ª—é—á–∞—è –∑–∞–≤–∏—Å–∏–º—ã–µ –ø—É—Ç–∏ –∏ —Å–∏–≥–Ω–∞–ª –¥–ª—è –æ—Ç–º–µ–Ω—ã. üîß

---

### 9. **poll** üîÑ

–ú–µ—Ç–æ–¥ –¥–ª—è –æ–ø—Ä–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫.

```typescript
poll<P extends Paths<T>>(
  path: P,
  fetchFn: (current: ExtractPathType<T, P>) => Promise<ExtractPathType<T, P>>,
  options: {
    interval?: number;
    cacheKey?: CacheKey;
    retryCount?: number;
    retryDelay?: number;
    onError?: (error: unknown) => void;
    exponentialBackoff?: boolean;
  }
)
```

**–ê—Ä–≥—É–º–µ–Ω—Ç—ã:**

- `path`: –ü—É—Ç—å –∫ –¥–∞–Ω–Ω—ã–º, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –æ–ø—Ä–∞—à–∏–≤–∞—Ç—å. üõ£Ô∏è
- `fetchFn`: –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å. üîÑ
- `options`: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫. üîÅ

---

### 10. **stopPolling** üõë

–ú–µ—Ç–æ–¥ –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ–ø—Ä–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫–ª—é—á—É.

```typescript
stopPolling(cacheKey: CacheKey)
```

**–ê—Ä–≥—É–º–µ–Ω—Ç:**

- `cacheKey`: –ö–ª—é—á, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –Ω—É–∂–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–ø—Ä–æ—Å. üõë

---

### 11. **cancelFetch** ‚ùå

–ú–µ—Ç–æ–¥ –¥–ª—è –æ—Ç–º–µ–Ω—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

```typescript
cancelFetch(key: CacheKey)
```

**–ê—Ä–≥—É–º–µ–Ω—Ç:**

- `key`: –ö–ª—é—á –∑–∞–ø—Ä–æ—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å. üõë

---

### 12. **cancelAllFetches** ‚ùå

–ú–µ—Ç–æ–¥ –¥–ª—è –æ—Ç–º–µ–Ω—ã –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

```typescript
cancelAllFetches();
```

---

### 13. **clearCache** üßπ

–ú–µ—Ç–æ–¥ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ–≥–æ –∫—ç—à–∞.

```typescript
clearCache();
```

---

### 14. **destroy** üí•

–ú–µ—Ç–æ–¥ –¥–ª—è —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å–æ–∫ –∏ –∫—ç—à–∞.

```typescript
destroy();
```

---

## üß© –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```typescript
import { createQueryStore } from "@qtpy/state-management-observable";

// –°–æ–∑–¥–∞–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
const store = createQueryStore({ user: null });

// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
store.addErrorHandler((error) => {
  console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:", error);
});

// –í—ã–ø–æ–ª–Ω—è–µ–º –º—É—Ç–∞—Ü–∏—é
const userMutation = store.createMutation({
  mutationFn: async (input) => {
    return await someApiCall(input);
  },
  invalidateTags: ["user-data"],
  onSuccess: (data) => console.log("–ú—É—Ç–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ", data),
});
```

---

## üß† –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ **createQueryStore** –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ—â–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º, –ø–æ–∑–≤–æ–ª—è—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –º—É—Ç–∞—Ü–∏–π –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫. –≠—Ç–æ –∏–¥–µ–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏, –∫–æ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫. üöÄ

---
