# –ü—Ä–∏–º–µ—Ä –∏ –∫—Ä–∞—Ç–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ `ObservableStore`

1. [–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–æ—Å–Ω–æ–≤–Ω–∞—è-–∏–¥–µ—è-–∏-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)  
   1.1. [–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π Proxy](#–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π-proxy)  
   1.2. [–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∫–ª—é—á–µ–π](#–ø–æ–¥–¥–µ—Ä–∂–∫–∞-—Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö-—Å—Ç—Ä–æ–∫–æ–≤—ã—Ö-–∫–ª—é—á–µ–π)  
   1.3. [–ü–æ–¥–ø–∏—Å–∫–∏ —Å ¬´–≥—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—å—é¬ª –ø—É—Ç–µ–π](#–ø–æ–¥–ø–∏—Å–∫–∏-—Å-–≥—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—å—é-–ø—É—Ç–µ–π)  
   1.4. [–ö—ç—à-–∫–ª—é—á–∏ (cacheKeys)](#–∫—ç—à-–∫–ª—é—á–∏-cachekeys)  
   1.5. [Middleware-–ø–æ–¥—Ö–æ–¥](#middleware-–ø–æ–¥—Ö–æ–¥)  
   1.6. [Batching-–æ–±—ë—Ä—Ç–∫–∞](#batching-–æ–±—ë—Ä—Ç–∫–∞)  
   1.7. [–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è](#–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)  
   1.8. [–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (undo/redo)](#–∏—Å—Ç–æ—Ä–∏—è-–∏–∑–º–µ–Ω–µ–Ω–∏–π-undoredo)  
   1.9. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ª—é–±—ã–º —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–º](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-–ª—é–±—ã–º-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–º)

2. [–ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ store (—Å middleware)](#–ø—Ä–∏–º–µ—Ä-—Å–æ–∑–¥–∞–Ω–∏—è-–æ—Å–Ω–æ–≤–Ω–æ–≥–æ-store-—Å-middleware)

3. [API createObservableStore](#api-createobservablestore)  
   3.1. [`store.state` / `store.$`](#storestate--store)  
   3.2. [`store.subscribe(callback, cacheKeys?)`](#storesubscribecallback-cachekeys)  
   3.3. [`store.subscribeToPath(pathOrAccessor, callback, options?)`](#storesubscribetopathpathoraccessor-callback-options)  
   3.4. [`store.invalidate(cacheKey)`](#storeinvalidatecachekey)  
   3.5. [`store.get(pathOrAccessor)`](#storegetpathoraccessor)  
   3.6. [`store.update(pathOrAccessor, valueOrFn)`](#storeupdatepathoraccessor-valueorfn)  
   3.7. [`store.resolveValue(pathOrAccessor, valueOrFn)`](#storeresolvevaluepathoraccessor-valueorfn)

4. [–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è](#–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)  
   4.1. [`store.asyncUpdate(pathOrAccessor, asyncUpdater, options?)`](#storeasyncupdatepathoraccessor-asyncupdater-options)  
   4.2. [`store.cancelAsyncUpdates(pathOrAccessor?)`](#storecancelasyncupdatespathoraccessor)

5. [–ë–∞—Ç—á–∏–Ω–≥ (`store.batch`)](#–±–∞—Ç—á–∏–Ω–≥-storebatch)

6. [–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (undo/redo)](#–∏—Å—Ç–æ—Ä–∏—è-–∏–∑–º–µ–Ω–µ–Ω–∏–π-undoredo)  
   6.1. [`store.undo(pathOrAccessor)`](#storeundopathoraccessor)  
   6.2. [`store.redo(pathOrAccessor)`](#storeredopathoraccessor)

7. [–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞](#—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞-–∏-–æ—á–∏—Å—Ç–∫–∞)  
   7.1. [`store.getMemoryStats()`](#storegetmemorystats)  
   7.2. [`store.clearStore()`](#storeclearstore)

8. [–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (Middleware)](#–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è-–æ–±—Ä–∞–±–æ—Ç–∫–∞-middleware)  
   8.1. [–ö–æ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç middleware](#1-–∫–æ–≥–¥–∞-—Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç-middleware)  
   8.2. [–ò–∑–º–µ–Ω–µ–Ω–∏–µ `value` –≤–Ω—É—Ç—Ä–∏ middleware](#2-–∏–∑–º–µ–Ω–µ–Ω–∏–µ-value-–≤–Ω—É—Ç—Ä–∏-middleware)  
   8.3. [–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è](#3-–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞-–∏–∑–º–µ–Ω–µ–Ω–∏—è)  
   8.4. [–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö middleware](#4-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å-–Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö-middleware)

9. [–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–∞–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞-—Ç–∞–∫–æ–≥–æ-–ø–æ–¥—Ö–æ–¥–∞)

10. [–í—ã–≤–æ–¥](#–≤—ã–≤–æ–¥)

---

–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥—ë–Ω –ø—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å—Ç–æ—Ä–∞ (ObservableStore), –Ω–∞–ø–∏—Å–∞–Ω–Ω–æ–≥–æ –Ω–∞ TypeScript –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ñ—Ä–µ–π–º–≤–æ—Ä–∫—É. –¢–∞–∫–æ–π —Å—Ç–æ—Ä –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ ¬´–ø–æ–¥–∫–ª—é—á–∏—Ç—å¬ª –≤ –ª—é–±–æ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–µ (React, Vue, Svelte, Solid –∏ —Ç. –¥.) –ø—É—Ç—ë–º –Ω–∞–ø–∏—Å–∞–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–±—ë—Ä—Ç–æ–∫ (–∞–¥–∞–ø—Ç–µ—Ä–æ–≤) –ø–æ–≤–µ—Ä—Ö –±–∞–∑–æ–≤–æ–≥–æ API.

- –û–±–µ—Ä—Ç–∫–∞ –ø–æ–¥ react: [@qtpy/state-management-react](https://www.npmjs.com/package/@qtpy/state-management-react)

---

## –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

1. #### –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π Proxy

   –í—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é (`state`) –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ JavaScript Proxy, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏.

   - –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ Proxy ¬´—Å–æ–±–∏—Ä–∞–µ—Ç¬ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: –∫–∞–∫–∏–µ —É—á–∞—Å—Ç–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ —Ä–∞–∑–Ω—ã—Ö Accessor‚Äô–æ–≤ –∏–ª–∏ –ø–æ–¥–ø–∏—Å–æ–∫.
   - –ü—Ä–∏ –∑–∞–ø–∏—Å–∏ Proxy –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏ –≤ –∫–æ–Ω—Ü–µ –≤—ã–∑—ã–≤–∞–µ—Ç —Ü–µ–ø–æ—á–∫—É middleware –∏ –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤.

2. #### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∫–ª—é—á–µ–π

   - –í ObservableStore —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å—Ç—Ä–æ–≥–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ø—É—Ç–µ–π, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç:

   - –±–µ–∑–æ–ø–∞—Å–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç—Ä–æ–∫–∏ –ø—É—Ç–µ–π –≤—Ä–æ–¥–µ "user.settings.theme" –±–µ–∑ —Ä–∏—Å–∫–∞ –æ—à–∏–±–æ–∫ —Ç–∏–ø–æ–≤;

   - –ø–æ–ª—É—á–∞—Ç—å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—É—Ç–µ–π –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ TypeScript;

   - –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø—É—Ç–∏ –∏ –∑–Ω–∞—á–µ–Ω–∏—è: –µ—Å–ª–∏ –ø—É—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω ‚Äî TypeScript –ø–æ–¥—Å–∫–∞–∂–µ—Ç –æ–± –æ—à–∏–±–∫–µ –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏;

   - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–æ—Ä—Ç–µ–∂–∞–º –∏ –º–∞—Å—Å–∏–≤–∞–º –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º, –Ω–∞–ø—Ä–∏–º–µ—Ä: "items.0" –∏–ª–∏ "list.2.name".

   - –ø—Ä–∏–º–µ—Ä: [—Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É](https://raw.githubusercontent.com/TheOnlyFastCoder2/QtPy-library/refs/heads/main/state-management/main/packages/observable/assets/picture_autocomplete.png)

     <img src="https://raw.githubusercontent.com/TheOnlyFastCoder2/QtPy-library/refs/heads/main/state-management/main/packages/observable/assets/picture_autocomplete.png" width="1200"/>

3. #### –ü–æ–¥–ø–∏—Å–∫–∏ —Å ¬´–≥—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—å—é¬ª –ø—É—Ç–µ–π

   - –ú–æ–∂–Ω–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ª—é–±–æ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø–æ–ª–µ –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É—è –ª–∏–±–æ —Å—Ç—Ä–æ–∫—É-–ø—É—Ç—å (`"user.settings.theme"`), –ª–∏–±–æ Accessor: `(t) => store.state.user.settings.theme`.
   - –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏–º–µ–Ω–Ω–æ —ç—Ç–æ–≥–æ –ø–æ–ª—è –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –ø–æ–ª—É—á–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—è—Ö –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç —ç—Ç—É –ø–æ–¥–ø–∏—Å–∫—É.

4. #### –ö—ç—à-–∫–ª—é—á–∏ (cacheKeys)

   - –ü–æ–∑–≤–æ–ª—è—é—Ç –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å ¬´–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏¬ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞).
   - –ü—Ä–∏ –≤—ã–∑–æ–≤–µ `store.invalidate(key)` –≤—Å–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏, –ø–µ—Ä–µ–¥–∞–≤—à–∏–µ —ç—Ç–æ—Ç `cacheKey` –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∫–µ, –±—É–¥—É—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω—ã, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –ø–æ–ª–µ –æ—Å—Ç–∞–ª—Å—è —Ç–µ–º –∂–µ.

5. #### Middleware-–ø–æ–¥—Ö–æ–¥

   - –ü—Ä–∏ –∫–∞–∂–¥–æ–º `update` (–∏–ª–∏ –ø—Ä—è–º–æ–π –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ Proxy) –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ü–µ–ø–æ—á–∫—É middleware, —á—Ç–æ–±—ã –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å, –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è.
   - –ö–∞–∂–¥—ã–π middleware –≤–∏–¥–∏—Ç –ø—É—Ç—å (`string`) –∏ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –º–æ–∂–µ—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ.

6. #### Batching-–æ–±—ë—Ä—Ç–∫–∞

   - –ü–æ–∑–≤–æ–ª—è–µ—Ç ¬´—Å–∫–ª–µ–∏–≤–∞—Ç—å¬ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –æ–¥–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ. –≠—Ç–æ –≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã –Ω–µ –≤—ã–∑—ã–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–π —Ä–µ—Ä–µ–Ω–¥–µ—Ä UI –ø—Ä–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö.

7. #### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

   - –ú–µ—Ç–æ–¥ `asyncUpdate(pathOrAccessor, asyncFn, options?)` –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (fetch, —Ç–∞–π–º–µ—Ä—ã, –∑–∞–ø—Ä–æ—Å—ã) –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–º–µ–Ω—è—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ, –µ—Å–ª–∏ –æ–Ω–∏ –≤—Å—ë –µ—â—ë –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ (–æ–ø—Ü–∏—è `abortPrevious`).

8. #### –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (undo/redo)

   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Å—Ç–µ–∫ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π (–¥–æ `maxHistoryLength`).
   - –ú–µ—Ç–æ–¥—ã `undo(pathOrAccessor)` –∏ `redo(pathOrAccessor)` –ø–æ–∑–≤–æ–ª—è—é—Ç –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ/—Å–ª–µ–¥—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è.

9. #### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ª—é–±—ã–º —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–º

   - –ë–∞–∑–æ–≤–æ–µ API —Å—Ç–æ—Ä–∞ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç React/Vue –∏ —Ç.‚Ää–¥.
   - –î–ª—è React –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å —Ö—É–∫ `useObservableStore`, –∫–æ—Ç–æ—Ä—ã–π –≤–Ω—É—Ç—Ä–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `store.subscribeToPath` —Å Accessor‚Äô–æ–º, –∏ –¥–∏—Å–ø–∞—Ç—á–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è Vue/Svelte/Solid –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –∞–¥–∞–ø—Ç–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ Proxy –≤—ã–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ.

---

## –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ `store` (—Å middleware)

```ts
// ObservableStore.ts
import {
  createObservableStore,
  Middleware,
  Accessor,
  SubscriptionCallback,
} from "./index";
// 1) –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π interface :
export interface StoreState {
  user: {
    name: string;
    age: number;
    settings: {
      theme: string;
      locale: string;
    };
  };
  items: number[];
  counter: number;
}

// 2) –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —Å—Ç–µ–π—Ç:
const initialState = {
  user: {
    name: "Alice",
    age: 30,
    settings: {
      theme: "light",
      locale: "ru",
    },
  },
  items: [1, 2, 3],
  counter: 0,
};
// 3) –ì–ª—É–±–∏–Ω–∞ —Ç–∏–ø –ø–æ–∏—Å–∫–∞ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ø—É—Ç–µ–π
type DepthPath = 14;
// 3) –ü—Ä–∏–º–µ—Ä middleware: –ø—Ä–æ—Å—Ç–æ–π –ª–æ–≥–≥–µ—Ä –ø–µ—Ä–µ–¥ –∏ –ø–æ—Å–ª–µ update
const loggerMiddleware: Middleware<StoreState, DepthPath> = (store, next) => {
  return (path, value) => {
    console.log(
      `[Logger] –î–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: –ø—É—Ç—å="${path}", —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ=`,
      store.get(path)
    );
    next(path, value);
    console.log(
      `[Logger] –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: –ø—É—Ç—å="${path}", –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ=`,
      store.get(path)
    );
  };
};

// 3) –°–æ–∑–¥–∞—ë–º —Å—Ç–æ—Ä —Å middleware –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –∏—Å—Ç–æ—Ä–∏–∏:
export const store = createObservableStore<State, DepthPath>(
  initialState,
  [loggerMiddleware], // —Ü–µ–ø–æ—á–∫–∞ middleware
  { maxHistoryLength: 50 }
);

// –¢–µ–ø–µ—Ä—å –ø—Ä–∏ –≤—ã–∑–æ–≤–µ store.update(...) –∏–ª–∏ –ø—Ä–∏ –ø—Ä—è–º–æ–π –∑–∞–ø–∏—Å–∏ –≤ store.state
// —Å—Ä–∞–±–æ—Ç–∞—é—Ç middleware –∏, –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏, —É–≤–µ–¥–æ–º—è—Ç—Å—è –ø–æ–¥–ø–∏—Å—á–∏–∫–∏.
```

### üî¢ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç `DepthPath`

`DepthPath` —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–º, –Ω–∞—Å–∫–æ–ª—å–∫–æ –≥–ª—É–±–æ–∫–æ TypeScript –±—É–¥–µ—Ç "—Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å" –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–∞, —á—Ç–æ–±—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –ø—É—Ç–∏ –≤–∏–¥–∞ `"user.settings.locale"`, `"items.0"` –∏ —Ç. –¥.

```
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å—Ç–æ–∏—Ç `DepthPath=0`.
```

---

#### ‚úÖ `DepthPath = 0`

- **–¢–∏–ø—ã –ø—É—Ç–µ–π –Ω–µ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –≤–æ–æ–±—â–µ.**
- –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤ –ø—É—Ç–µ–π (`SafePaths`, `PathExtract`, `PathOrAccessor`) —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∑–∞–≥–ª—É—à–∫–∞–º–∏.
- –ó–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –ø–æ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º —Å—Ç—Ä–æ–∫–∞–º, –Ω–æ:

  - ‚ùå **–∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç–∞ –Ω–µ—Ç**,
  - ‚ùå **—Ç–∏–ø–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Ç–µ–π –∏ –∑–Ω–∞—á–µ–Ω–∏–π –æ—Ç–∫–ª—é—á–µ–Ω–∞**,
  - ‚úÖ –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–æ–±–Ω–æ –¥–ª—è –º–æ–∫–æ–≤, —Ç–µ—Å—Ç–æ–≤, –∏–ª–∏ —Å–≤–æ–±–æ–¥–Ω–æ–π —Ä–∞–±–æ—Ç—ã –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

#### ‚ö†Ô∏è `DepthPath = 14` –∏ –≤—ã—à–µ

- ‚ö†Ô∏è **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –º–µ–¥–ª–µ–Ω–Ω–æ**: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è union-—Ç–∏–ø–æ–≤ –ø—É—Ç–µ–π —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π.
- ‚úÖ –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –≥–ª—É–±–æ–∫–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–º –ø—É—Ç—è–º, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å.
- ‚ùå –ù–æ –º–æ–∂–µ—Ç:

  - –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ **–∑–∞–º–µ–¥–ª–µ–Ω–∏—é –∏–ª–∏ –∑–∞–≤–∏—Å–∞–Ω–∏—é TypeScript/IDE (VSCode)**,
  - –≤—ã–∑–≤–∞—Ç—å **–æ—à–∏–±–∫–∏ "Type instantiation is excessively deep..."** –ø—Ä–∏ —Å–ª–æ–∂–Ω—ã—Ö —Ç–∏–ø–∞—Ö.

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:**

> –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `DepthPath > 10`, **–µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ —ç—Ç–æ –Ω–µ –æ–ø—Ä–∞–≤–¥–∞–Ω–æ —Ä–µ–∞–ª—å–Ω–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏.**

### üß† –ò—Ç–æ–≥

| `DepthPath` | –ü–æ–≤–µ–¥–µ–Ω–∏–µ                                                               |
| ----------- | ----------------------------------------------------------------------- |
| `0`         | –ó–∞–≥–ª—É—à–∫–∞: –ª—é–±—ã–µ —Å—Ç—Ä–æ–∫–∏, –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç–∞                     |
| `1‚Äì7`       | –û–ø—Ç–∏–º–∞–ª—å–Ω–æ: –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø—É—Ç–∏, —Ä–∞–∑—É–º–Ω–∞—è –≥–ª—É–±–∏–Ω–∞                           |
| `8‚Äì13`      | –î–æ–ø—É—Å—Ç–∏–º–æ, –Ω–æ —É–∂–µ –º–æ–∂–µ—Ç —Ç–æ—Ä–º–æ–∑–∏—Ç—å IDE                                   |
| `14+`       | –†–∏—Å–∫ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞, –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –±–µ–∑ –∫—Ä–∞–π–Ω–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ |

---

---

## API `createObservableStore`

### `store.state` / `store.$`

- **–ß—Ç–æ —ç—Ç–æ:** —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π Proxy-–æ–±—ä–µ–∫—Ç —Å —Ç–µ–∫—É—â–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º (readonly —Å–Ω–∞—Ä—É–∂–∏).

- **–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:**

  ```ts
  // –ß—Ç–µ–Ω–∏–µ:
  console.log(store.state.user.name); // "Alice"
  console.log(store.$.items.length); // 3

  // –ü—Ä—è–º–∞—è –∑–∞–ø–∏—Å—å (—á–µ—Ä–µ–∑ Proxy) ¬´–∞–≤—Ç–æ–º–∞—Ç–æ–º¬ª –≤—ã–∑—ã–≤–∞–µ—Ç middleware –∏ –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤:
  store.state.user.name = "Bob";
  store.state.items.push(4);
  ```

- **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** `store.$` ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Å–∏–Ω–æ–Ω–∏–º `store.state`. –£–¥–æ–±–Ω–æ –¥–ª—è –≤–Ω—É—Ç—Ä—è–Ω–∫–∏.

---

### `store.subscribe(callback, cacheKeys?)`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞ **–ª—é–±–æ–π** –∞–ø–¥–µ–π—Ç –≤—Å–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–≥–ª–æ–±–∞–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞).

- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

  1. `callback: (newState: typeof initialState) => void` ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ ¬´–±–∞—Ç—á–∞¬ª –∏–∑–º–µ–Ω–µ–Ω–∏–π.
  2. `cacheKeys?: string[]` ‚Äî –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∫–ª—é—á–µ–π (cacheKey). –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏–¥—ë—Ç —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞:

     - –∏–∑–º–µ–Ω–∏–ª—Å—è –ª—é–±–æ–π –∫—É—Å–æ–∫ —Å—Ç–µ–π—Ç–∞, –∏ –ø—Ä–∏ —ç—Ç–æ–º –æ–¥–∏–Ω –∏–∑ —ç—Ç–∏—Ö cacheKeys –±—ã–ª –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω (`store.invalidate`), –ª–∏–±–æ
     - –Ω–∞–ø—Ä—è–º—É—é –±—ã–ª–æ –≤—ã–∑–≤–∞–Ω–æ `store.invalidate(cacheKey)`.

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –≤—Å–µ –∞–ø–¥–µ–π—Ç—ã:
  const unsubAll = store.subscribe((fullState) => {
    console.log("–í–µ—Å—å —Å—Ç–µ–π—Ç –∏–∑–º–µ–Ω–∏–ª—Å—è:", fullState);
  });

  // –ü–æ–¥–ø–∏—Å–∫–∞, –æ–ø–∏—Ä–∞—é—â–∞—è—Å—è –Ω–∞ cacheKey "user.settings.theme":
  const unsubFiltered = store.subscribe(
    (fullState) =>
      console.log("–¢–µ–º–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", fullState.user.settings.theme),
    ["user.settings.theme"]
  );

  // –û—Ç–ø–∏—Å–∫–∞:
  unsubAll();
  unsubFiltered();
  ```

---

### `store.subscribeToPath(pathOrAccessor, callback, options?)`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è **–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—è** (–ø—É—Ç–∏) –≤ —Å—Ç–µ–π—Ç–µ, –∏—Å–ø–æ–ª—å–∑—É—è –ª–∏–±–æ —Å—Ç—Ä–æ–∫—É-–ø—É—Ç—å, –ª–∏–±–æ Accessor<T>.

- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

  1. `pathOrAccessor: string | Accessor<any>`

     - **`string`**: –Ω–∞–ø—Ä–∏–º–µ—Ä, `"user.age"` –∏–ª–∏ `"items.0"`
     - **`Accessor<any>`**: —Ñ—É–Ω–∫—Ü–∏—è `(t?) => store.state.some.nested[t(dynamicIndex), ‚Ä¶]`
       ‚Äî –µ—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è, –Ω–æ –∏–Ω–¥–µ–∫—Å –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å Accessor.

  2. `callback: (newValue: any) => void` ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø—É—Ç–∏.
  3. `options?: { immediate?: boolean; cacheKeys?: string[] }` ‚Äî

     - `immediate: true` ‚Äî —Å—Ä–∞–∑—É –≤—ã–∑—ã–≤–∞–µ–º callback —Å —Ç–µ–∫—É—â–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º, –¥–∞–∂–µ –¥–æ –ø–µ—Ä–≤–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è.
     - `cacheKeys: string[]` ‚Äî —Å–ø–∏—Å–æ–∫ cacheKeys; –∫–æ–ª–±—ç–∫ –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –ø—Ä–∏ —ç—Ç–æ–º —Å–æ–±—ã—Ç–∏–∏, –¥–∞–∂–µ –µ—Å–ª–∏ –ø—É—Ç—å –Ω–µ –º–µ–Ω—è–ª—Å—è –Ω–∞–ø—Ä—è–º—É—é (—Å–º. `store.invalidate`).

- **–ü—Ä–∏–º–µ—Ä—ã:**

  ```ts
  // 1) –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ user.name –ø–æ —Å—Ç—Ä–æ–∫–æ–≤–æ–º—É –ø—É—Ç–∏:
  const unsubName = store.subscribeToPath(
    "user.name",
    (newName) => console.log("–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", newName),
    { immediate: true }
  );

  // 2) –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞ items:
  //    –ó–¥–µ—Å—å index –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤–Ω—É—Ç—Ä–∏ Accessor —á–µ—Ä–µ–∑ t(index)
  let idx = 0;
  const unsubFirstItem = store.subscribeToPath(
    (t) => store.state.items[t(idx)], // Accessor<any>
    (val) => console.log("–ü–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞:", val),
    { cacheKeys: ["counter"] }
  );

  // 3) –û—Ç–ø–∏—Å–∫–∞:
  unsubName();
  unsubFirstItem();
  ```

---

### `store.invalidate(cacheKey)`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–π —Å—Ç—Ä–æ–∫–æ–≤—ã–π –∫–ª—é—á (`cacheKey`).

  - –í—Å–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∫–µ –ø–µ—Ä–µ–¥–∞–ª–∏ —ç—Ç–æ—Ç –∫–ª—é—á –≤ `cacheKeys`, –ø—Ä–∏–¥—ë—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–¥–∞–∂–µ –µ—Å–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –∏—Ö –ø—É—Ç–∏ –Ω–µ –º–µ–Ω—è–ª–æ—Å—å).

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  // –ï—Å–ª–∏ –≥–¥–µ-—Ç–æ –≤ –ª–æ–≥–∏–∫–µ –Ω—É–∂–Ω–æ —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞—Ç—å –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ –ø–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º, –ø–æ–ª–∞–≥–∞—é—â–∏–º—Å—è –Ω–∞ cacheKey:
  store.invalidate("user.settings.theme");
  ```

---

### `store.get(pathOrAccessor)`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É `pathOrAccessor`.

  - –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω `string` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `store.state[path]` (–∏–ª–∏ `undefined`, –µ—Å–ª–∏ –ø—É—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω).
  - –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω `Accessor<any>` ‚Üí –≤–Ω—É—Ç—Ä–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è ¬´–∑–∞–≥–ª—É—à–∫–∞¬ª `t`(–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞), –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è Accessor, –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  const age = store.get("user.age"); // 30
  console.log("–í–æ–∑—Ä–∞—Å—Ç:", age);

  // –ü—Ä–∏–º–µ—Ä —Å Accessor: —á–∏—Ç–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞ –ø–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–º—É –∏–Ω–¥–µ–∫—Å—É
  let idx = 1;
  const firstItem = store.get((t) => store.state.items[t(idx)]);
  console.log("–í—Ç–æ—Ä–æ–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞:", firstItem); // 2
  ```

---

### `store.update(pathOrAccessor, valueOrFn)`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É `pathOrAccessor`.

  - `pathOrAccessor: string | Accessor<any>`

    - –ï—Å–ª–∏ `string` ‚Üí –æ–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á.
    - –ï—Å–ª–∏ `Accessor<any>` ‚Üí –≤–Ω—É—Ç—Ä–∏ Accessor –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é `t(...)` –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø—É—Ç–∏, –∑–∞—Ç–µ–º –æ–±–Ω–æ–≤–ª—è–µ—Ç —ç—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ.

  - `valueOrFn` –º–æ–∂–µ—Ç –±—ã—Ç—å:

    1. **–ü—Ä—è–º—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º**:

       ```ts
       store.update("user.age", 35);
       ```

    2. **–§—É–Ω–∫—Ü–∏–µ–π** `(cur) => next`: –≤—ã—á–∏—Å–ª—è–µ—Ç –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–µ–≥–æ:

       ```ts
       store.update("user.age", (cur) => cur + 1);
       ```

    3. **–ï—Å–ª–∏ Accessor**: –Ω–∞–ø—Ä–∏–º–µ—Ä,

       ```ts
       let idx = 2;
       store.update(
         (t) => store.state.items[t(idx)],
         (cur) => cur * 10
       );
       ```

       ‚Äî —Ç—É—Ç `t(idx)` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∏—Å–ª–æ `2`, –∏ –æ–±–Ω–æ–≤–∏—Ç—Å—è `items[2]`.

  - –ü—Ä–∏ –∑–∞–ø–∏—Å–∏:

    - –°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é (–¥–æ `maxHistoryLength`).
    - –ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è middleware (–≤ –ø–æ—Ä—è–¥–∫–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏).
    - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ.
    - –í –∫–æ–Ω—Ü–µ —É–≤–µ–¥–æ–º–ª—è—é—Ç—Å—è –ø–æ–¥–ø–∏—Å—á–∏–∫–∏.

- **–ü—Ä–∏–º–µ—Ä—ã:**

  ```ts
  // 1) –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Å—Ç—Ä–æ–∫–æ–≤—ã–π –ø—É—Ç—å:
  store.update("user.age", 35);
  store.update("user.age", (cur) => cur + 1);

  // 2) –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Accessor + –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–Ω–¥–µ–∫—Å:
  let dynamicIdx = 0;
  store.update((t) => store.state.items[t(dynamicIdx)], 42);
  // –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ items[0] —Å—Ç–∞–Ω–µ—Ç 42.

  // 3) –ü—Ä—è–º—ã–µ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ Proxy:
  //    Proxy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –Ω–∞ store.update
  store.state.user.name = "Charlie";
  store.state.items[1] = 100;
  // ‚Üí –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ –Ω–∞ "user.name" –∏ "items.1" –ø–æ–ª—É—á–∞—Ç –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é.
  ```

---

### `store.resolveValue(pathOrAccessor, valueOrFn)`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –≤—ã—á–∏—Å–ª—è–µ—Ç, –∫–∞–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—É—á–∏—Ç—Å—è –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ `valueOrFn`, **–Ω–æ –±–µ–∑ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–ø–∏—Å–∏** –≤ —Å—Ç–æ—Ä.

  - –£–¥–æ–±–Ω–æ, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ —É–∑–Ω–∞—Ç—å, –∫–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ, –Ω–æ –µ—â—ë –Ω–µ –ø—Ä–∏–º–µ–Ω—è—Ç—å —ç—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ.

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  const nextCounter = store.resolveValue("counter", (cur) => cur + 5);
  console.log("–ë—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π counter:", nextCounter);
  // –ù–æ store.get("counter") –æ—Å—Ç–∞—ë—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º.
  ```

---

## –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### `store.asyncUpdate(pathOrAccessor, asyncUpdater, options?)`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é, –ø–µ—Ä–µ–¥–∞—é—â—É—é —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏ `AbortSignal`, –∞ –∑–∞—Ç–µ–º –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø—É—Ç—å.

  - –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω `options.abortPrevious: true`, –ø—Ä–µ–¥—ã–¥—É—â–∏–π –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ —Ç–æ–º—É –∂–µ –ø—É—Ç–∏ –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω—ë–Ω –ø—Ä–∏ –ø–æ–º–æ—â–∏ `AbortController`.

- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

  1. `pathOrAccessor: string | Accessor<any>`
  2. `asyncUpdater: (currentValue: any, signal: AbortSignal) => Promise<any>`
  3. `options?: { abortPrevious?: boolean }`

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  // –ó–∞–≥—Ä—É–∑–∏–º —Å–ø–∏—Å–æ–∫ —Å —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∑–∞–ø–∏—à–µ–º –≤ state.items:
  await store.asyncUpdate(
    "items",
    async (currentItems, signal) => {
      const response = await fetch("/api/items", { signal });
      const data = await response.json();
      return data.list;
    },
    { abortPrevious: true }
  );
  ```

---

### `store.cancelAsyncUpdates(pathOrAccessor?)`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –æ—Ç–º–µ–Ω—è–µ—Ç –≤—Å–µ ¬´–≤–∏—Å—è—â–∏–µ¬ª (in-flight) `asyncUpdate` –≤—ã–∑–æ–≤—ã.

  - –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω `pathOrAccessor`, —Ç–æ –æ—Ç–º–µ–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ –ø—É—Ç–∏, –∏–Ω–∞—á–µ –¥–ª—è –≤—Å–µ—Ö.

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  // –û—Ç–º–µ–Ω–∏—Ç—å –≤—Å–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
  store.cancelAsyncUpdates();

  // –û—Ç–º–µ–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—É—Ç–∏ "items":
  store.cancelAsyncUpdates("items");
  ```

---

## –ë–∞—Ç—á–∏–Ω–≥ (`store.batch`)

### `store.batch(callback)`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ –±–ª–æ–∫–∞, –æ—Ç–∫–ª–∞–¥—ã–≤–∞—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º –¥–æ –∫–æ–Ω—Ü–∞.

  - –í–Ω—É—Ç—Ä–∏ `callback` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ `store.update(...)`, —Ç–∞–∫ –∏ –ø—Ä—è–º—ã–µ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ `store.state` (Proxy).
  - –ü–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ `callback` —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –µ–¥–∏–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

- **–ü—Ä–∏–º–µ—Ä—ã:**

  ```ts
  // 1) –ß–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ update:
  await store.batch(() => {
    store.update("user.name", "Charlie");
    store.update("user.age", (cur) => cur + 2);
    store.update("items.0", 100);
  });
  // –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ –ø–æ–ª—É—á–∞—Ç –æ–¥–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.

  // 2) –° –ø—Ä—è–º—ã–º–∏ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏—è–º–∏:
  await store.batch(() => {
    store.state.user.name = "Charlie";
    store.state.user.age = 23;
    store.state.items[0] = 100;
    store.state.items[2] = 2323; // –≤—Å—ë –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π –±–∞—Ç—á–∏
  });
  // –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ —É–≤–∏–¥—è—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ "user.name", "user.age" –∏ "items.0", "items.2" –æ–¥–Ω–∏–º –∫–æ–ª–±—ç–∫–æ–º.
  ```

---

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (undo/redo)

### `store.undo(pathOrAccessor)`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç (undo) –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –ø—É—Ç–∏ (–∏–ª–∏ Accessor).

  - –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∞—è –∑–∞–ø–∏—Å—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true` –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ. –ò–Ω–∞—á–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `false`.

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  store.update("counter", 10);
  store.update("counter", 20);

  console.log(store.get("counter")); // 20
  store.undo("counter");
  console.log(store.get("counter")); // 10
  ```

---

### `store.redo(pathOrAccessor)`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ø–æ–≤—Ç–æ—Ä—è–µ—Ç (redo) –ø–æ—Å–ª–µ–¥–Ω–µ–µ –æ—Ç–∫–∞—Ç–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –ø—É—Ç–∏.

  - –ï—Å–ª–∏ –µ—Å—Ç—å ¬´–æ—Ç–º–µ–Ω—ë–Ω–Ω–æ–µ¬ª –∑–Ω–∞—á–µ–Ω–∏–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true` –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –µ–≥–æ. –ò–Ω–∞—á–µ `false`.

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  // –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø—Ä–∏–º–µ—Ä–∞:
  store.undo("counter"); // –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫ 10
  store.redo("counter");
  console.log(store.get("counter")); // 20
  ```

---

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞

### `store.getMemoryStats()`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Å —Ç–µ–∫—É—â–∏–º–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏:

  - `subscribersCount` ‚Äî —á–∏—Å–ª–æ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤.
  - `pathSubscribersCount` ‚Äî —á–∏—Å–ª–æ –ø–æ–¥–ø–∏—Å–æ–∫ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –ø—É—Ç—è–º/Accessor‚Äô–∞–º.
  - `historyEntries` ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—É—Ç–µ–π –∏ –¥–ª–∏–Ω–∞ –∏—Ö –∏—Å—Ç–æ—Ä–∏–∏.
  - `activePathsCount` ‚Äî —á–∏—Å–ª–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—É—Ç–µ–π (–∑–∞ –∫–æ—Ç–æ—Ä—ã–º–∏ –∫—Ç–æ-—Ç–æ —Å–ª–µ–¥–∏—Ç).

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  const stats = store.getMemoryStats();
  console.log("–ì–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤:", stats.subscribersCount);
  console.log("–ü–æ–¥–ø–∏—Å–æ–∫ –ø–æ –ø—É—Ç—è–º:", stats.pathSubscribersCount);
  console.log("–ò—Å—Ç–æ—Ä–∏—è:", stats.historyEntries);
  ```

---

### `store.clearStore()`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:

  - –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –ø–æ–¥–ø–∏—Å–∫–∏ (–≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∏ –ø–æ –ø—É—Ç—è–º).
  - –û—Ç–º–µ–Ω—è–µ—Ç –≤—Å–µ ¬´–≤–∏—Å—è—â–∏–µ¬ª –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.
  - –û—á–∏—â–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ç–∞–π–º–µ—Ä—ã (–µ—Å–ª–∏ –µ—Å—Ç—å) –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å.

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  // –ö–æ–≥–¥–∞ —Å—Ç–æ—Ä –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω:
  store.clearStore();
  ```

---

## –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (Middleware)

`Middleware` ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ ¬´–æ–±–æ—Ä–∞—á–∏–≤–∞—é—Ç¬ª –≤—ã–∑–æ–≤—ã `store.update(...)` –∏ –¥–∞—é—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å (–º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å, –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å, –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å) –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è.

### 1. –ö–æ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç middleware

- Middleware –≤—ã–∑—ã–≤–∞—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ** –ø—Ä–∏:

  1. –≤—ã–∑–æ–≤–µ `store.update(...)`, –∏–ª–∏
  2. –ø—Ä—è–º–æ–π –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ Proxy (`store.state.some.key = newValue`).

- –ï—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±–æ–π—Ç–∏ Proxy (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞–ø—Ä—è–º—É—é –ø–æ–º–µ–Ω—è—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ¬´—Å—ã—Ä–æ–π¬ª –æ–±—ä–µ–∫—Ç –≤–Ω–µ Proxy), middleware –Ω–µ –∑–∞–ø—É—Å—Ç—è—Ç—Å—è.

```ts
// –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è middleware:
store.update("user.name", "Dmitry");
store.state.user.name = "Dmitry"; // Proxy –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∏ –∏–¥—ë—Ç —á–µ—Ä–µ–∑ middleware

// –ù–ï –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç middleware (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
// (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ¬´—Å—ã—Ä—ã–π¬ª –æ–±—ä–µ–∫—Ç –∑–¥–µ—Å—å –Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç Proxy)
(store as any).rawState.user.name = "Eve";
```

---

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ `value` –≤–Ω—É—Ç—Ä–∏ middleware

–í–Ω—É—Ç—Ä–∏ middleware –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É `path` –∏ `value`. –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å `value` –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –ø–µ—Ä–µ–¥–∞—Ç—å –µ–≥–æ –¥–∞–ª—å—à–µ –ø–æ —Ü–µ–ø–æ—á–∫–µ, –≤—ã–∑–≤–∞–≤ `next(path, newValue)`.

```ts
const clampAgeMiddleware: Middleware<typeof initialState> = (store, next) => {
  return (path, value) => {
    if (path === "user.age") {
      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤–æ–∑—Ä–∞—Å—Ç –æ—Ç 0 –¥–æ 99:
      const clamped = Math.max(0, Math.min(99, value as number));
      next(path, clamped);
    } else {
      next(path, value);
    }
  };
};

// –¢–µ–ø–µ—Ä—å –ø—Ä–∏ store.update("user.age", 150) —Ä–µ–∞–ª—å–Ω–æ –ø–æ–ø–∞–¥—ë—Ç 99.
```

---

### 3. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è

–ï—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ middleware **–Ω–µ –≤—ã–∑–≤–∞—Ç—å** `next(path, value)`, –≤–µ—Å—å –¥–∞–ª—å–Ω–µ–π—à–∏–π –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ `update` ¬´–≥–ª–æ—Ö–Ω–µ—Ç¬ª ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è, –∞ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ middleware –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è.

```ts
const blockAgeMiddleware: Middleware<typeof initialState> = (store, next) => {
  return (path, value) => {
    if (path === "user.age") {
      console.warn("[Middleware] –ò–∑–º–µ–Ω–µ–Ω–∏–µ user.age –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ");
      // –ù–µ –≤—ã–∑—ã–≤–∞–µ–º next ‚Üí –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–µ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç
      return;
    }
    next(path, value);
  };
};

// –ü—Ä–æ–±—É–µ–º:
store.update("user.age", 40);
// –õ–æ–≥: [Middleware] –ò–∑–º–µ–Ω–µ–Ω–∏–µ user.age –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
// –í–æ–∑—Ä–∞—Å—Ç –æ—Å—Ç–∞—ë—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º

store.update("user.name", "Bob");
// –ü—Ä–æ—Ö–æ–¥–∏—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –¥–ª—è "user.name" –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è next.
```

---

### 4. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö middleware

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Ç–æ—Ä–∞ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –º–∞—Å—Å–∏–≤ middleware, –Ω–∞–ø—Ä–∏–º–µ—Ä: `[mw1, mw2, mw3]`. –ü–æ—Ä—è–¥–æ–∫ –≤—ã–∑–æ–≤–∞ (–ø–æ—Å–ª–µ —Ä–µ–≤–µ—Ä—Å–∞) —Ç–∞–∫–æ–≤:

1. mw1 ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç mw2
2. mw2 ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç mw3
3. mw3 ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç ¬´—è–¥—Ä–æ¬ª update

–ï—Å–ª–∏ –Ω–∞ –∫–∞–∫–æ–º-—Ç–æ —ç—Ç–∞–ø–µ `next` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –¥–∞–ª—å–Ω–µ–π—à–∏–µ middleware –∏ —Å–∞–º–æ —è–¥—Ä–æ –Ω–µ –ø–æ–ª—É—á–∞—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –∏ —Å—Ç–æ—Ä –Ω–µ –æ–±–Ω–æ–≤–∏—Ç—Å—è.

```ts
const mw1: Middleware<typeof initialState> = (store, next) => {
  return (path, value) => {
    console.log("[MW1] –î–æ", path, value);
    next(path, value);
    console.log("[MW1] –ü–æ—Å–ª–µ", path, store.get(path));
  };
};

const mw2: Middleware<typeof initialState> = (store, next) => {
  return (path, value) => {
    console.log("[MW2] –ü—Ä–æ–≤–µ—Ä—è–µ–º", path);
    if (path === "items.0") {
      console.log("[MW2] –ë–ª–æ–∫–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ items.0");
      return; // mw3 –∏ —è–¥—Ä–æ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è
    }
    next(path, value);
  };
};

const mw3: Middleware<typeof initialState> = (store, next) => {
  return (path, value) => {
    console.log("[MW3] –õ–æ–≥–∏–∫–∞ MW3");
    next(path, value);
  };
};

const store = createObservableStore(initialState, [mw1, mw2, mw3]);

// –ü—Ä–∏–º–µ—Ä:
store.update("items.0", 999);
// –õ–æ–≥:
// [MW1] –î–æ items.0 999
// [MW2] –ü—Ä–æ–≤–µ—Ä—è–µ–º items.0
// [MW2] –ë–ª–æ–∫–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ items.0
// ‚Üí mw1 –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –ø–æ—Å–ª–µ next, mw3 –Ω–µ –≤—ã–∑–æ–≤–µ—Ç—Å—è, update –Ω–µ –ø—Ä–∏–º–µ–Ω–∏—Ç—Å—è.

store.update("user.name", "Dmitry");
// –õ–æ–≥:
// [MW1] –î–æ user.name Dmitry
// [MW2] –ü—Ä–æ–≤–µ—Ä—è–µ–º user.name
// [MW3] –õ–æ–≥–∏–∫–∞ MW3
// [MW1] –ü–æ—Å–ª–µ user.name Dmitry
// ‚Üí –ó–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ.
```

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–∞–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

1. **–§—Ä–µ–π–º–≤–æ—Ä–∫-–∞–≥–Ω–æ—Å—Ç–∏—á–Ω–æ—Å—Ç—å**

   - –Ø–¥—Ä–æ —Å—Ç–æ—Ä–∞ –Ω–∞–ø–∏—Å–∞–Ω–æ ¬´—á–∏—Å—Ç–æ¬ª –Ω–∞ TypeScript, –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç React/Vue/Svelte.
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –∞–¥–∞–ø—Ç–µ—Ä (—Ö—É–∫ –∏–ª–∏ –ø–ª–∞–≥–∏–Ω), –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ü–µ–ø–ª—è—Ç—å—Å—è –∫ `store.subscribeToPath` –∏ –¥–∏—Å–ø–∞—Ç—á–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI.

2. **–¢–æ—á–Ω–∞—è –≥—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–æ–∫**

   - –ü–æ–¥–ø–∏—Å–∫–∏ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ —Å—Ç—Ä–æ–∫–æ–≤–æ–º—É –ø—É—Ç–∏ –∏–ª–∏ —á–µ—Ä–µ–∑ Accessor<T>, –≥–¥–µ –≤–Ω—É—Ç—Ä–∏ Accessor –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `t(‚Ä¶)` –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–µ–∫—Å–æ–≤.
   - –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –ø–æ —Ç–µ–º –ø–æ–ª—è–º, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω–∏ –ø–æ–¥–ø–∏—Å–∞–Ω—ã.

3. **Middleware –∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã**

   - –ú–æ–∂–Ω–æ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ –æ–ø–∏—Å–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏/–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏/—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–π –¥–æ –∏—Ö –∑–∞–ø–∏—Å–∏.
   - –ö–∞–∂–¥—ã–π middleware –º–æ–∂–µ—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `value` –∏–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–º–µ–Ω–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ.

4. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞**

   - `asyncUpdate` —Å –æ–ø—Ü–∏–µ–π `abortPrevious` –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç–ª–µ–≥–∞–Ω—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —Å–µ—Ç—å—é, –æ—Ç–º–µ–Ω—è—è –ø—Ä–µ–∂–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã, –µ—Å–ª–∏ –æ–Ω–∏ –±–æ–ª—å—à–µ –Ω–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã.

5. **–ò—Å—Ç–æ—Ä–∏—è, undo/redo**

   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É—Ç–∏. –£–¥–æ–±–Ω–æ –≤ UI –¥–ª—è –∫–Ω–æ–ø–æ–∫ ¬´–æ—Ç–º–µ–Ω–∏—Ç—å¬ª/¬´–≤–µ—Ä–Ω—É—Ç—å¬ª.

6. **Batching**

   - –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π, —á—Ç–æ–±—ã –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –ø–æ–ª—É—á–∏–ª–∏ –µ–¥–∏–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –∏ UI –Ω–µ –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–≤–∞–ª—Å—è –ø–æ –∫–∞–∂–¥–æ–º—É –º–µ–ª–∫–æ–º—É –∏–∑–º–µ–Ω–µ–Ω–∏—é.

7. **–ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ TypeScript**

   - –¢–∏–ø `Accessor<T> = (t: (arg: any) => any) => T` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –ø—É—Ç—è–º–∏.
   - –í—ã–∑–æ–≤—ã `store.get` –∏ `store.update` —Å Accessor‚Äô–æ–º –ø–æ–∑–≤–æ–ª—è—é—Ç —Ç–æ—á–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω—É–∂–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ –±–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥–∞ —Å—Ç—Ä–æ–∫.

---

## –í—ã–≤–æ–¥

- **ObservableStore** ‚Äî —ç—Ç–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π —Å—Ç–æ—Ä, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ –æ—Å–Ω–æ–≤–µ JavaScript Proxy, Accessor<T> –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π, granular –ø–æ–¥–ø–∏—Å–æ–∫ –∏ —Ü–µ–ø–æ—á–µ–∫ middleware.
- –ë–ª–∞–≥–æ–¥–∞—Ä—è ¬´—á–∏—Å—Ç–æ–º—É¬ª —è–¥—Ä—É, –Ω–∞–ø–∏—Å–∞–Ω–Ω–æ–º—É –Ω–∞ TypeScript, –µ–≥–æ –º–æ–∂–Ω–æ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ–¥–∫–ª—é—á–∞—Ç—å –≤ React, Vue 3, Svelte, Solid –∏ –¥—Ä—É–≥–∏–µ —Å—Ä–µ–¥—ã: –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –ª—ë–≥–∫–∏–µ –∞–¥–∞–ø—Ç–µ—Ä—ã –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ –∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞.
- **–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**:

  1. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π —á–µ—Ä–µ–∑ `Accessor<T>`, –≥–¥–µ –≤–Ω—É—Ç—Ä–∏ –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å `t(index)` –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞.
  2. –ì—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ —Ç–æ—á–µ—á–Ω–æ–º—É –ø—É—Ç–∏ –∏–ª–∏ Accessor‚Äô—É.
  3. Middleware –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
  4. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å –æ—Ç–º–µ–Ω–æ–π –ø—Ä–æ—à–ª—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (`asyncUpdate`).
  5. –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (undo/redo) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É—Ç–∏.
  6. –ë—ç—á–∏–Ω–≥ (`batch`) –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–µ–Ω –ª—ë–≥–∫–∏–π, –±—ã—Å—Ç—Ä–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–π, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≥–∏–±–∫–∏–π —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π —Å—Ç–æ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö Accessor‚Äô–æ–≤, –∏–∑–ª–æ–∂–µ–Ω–Ω—ã–π **ObservableStore** –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç –≤—Å–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã ¬´–∏–∑ –∫–æ—Ä–æ–±–∫–∏¬ª.
