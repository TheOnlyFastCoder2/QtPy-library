# –ü—Ä–∏–º–µ—Ä –∏ –∫—Ä–∞—Ç–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ `ObservableStore`

1. [–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–æ—Å–Ω–æ–≤–Ω–∞—è-–∏–¥–µ—è-–∏-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)  
   1.1. [–ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å](#–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è-—Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)  
   1.2. [–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∫–ª—é—á–µ–π](#–ø–æ–¥–¥–µ—Ä–∂–∫–∞-—Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö-—Å—Ç—Ä–æ–∫–æ–≤—ã—Ö-–∫–ª—é—á–µ–π)  
   1.3. [–ü–æ–¥–ø–∏—Å–∫–∏ —Å ¬´–≥—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—å—é¬ª –ø—É—Ç–µ–π](#–ø–æ–¥–ø–∏—Å–∫–∏-—Å-–≥—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—å—é-–ø—É—Ç–µ–π)  
   1.4. [–ö—ç—à-–∫–ª—é—á–∏ (cacheKeys)](#–∫—ç—à-–∫–ª—é—á–∏-cachekeys)  
   1.5. [Middleware-–ø–æ–¥—Ö–æ–¥](#middleware-–ø–æ–¥—Ö–æ–¥)  
   1.6. [Batching-–æ–±—ë—Ä—Ç–∫–∞](#batching-–æ–±—ë—Ä—Ç–∫–∞)  
   1.7. [–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è](#–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)  
   1.8. [–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (undo/redo)](#–∏—Å—Ç–æ—Ä–∏—è-–∏–∑–º–µ–Ω–µ–Ω–∏–π-undoredo)  
   1.9. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ª—é–±—ã–º —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–º](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-–ª—é–±—ã–º-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–º)

2. [–ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ store (—Å middleware)](#–ø—Ä–∏–º–µ—Ä-—Å–æ–∑–¥–∞–Ω–∏—è-–æ—Å–Ω–æ–≤–Ω–æ–≥–æ-store-—Å-middleware)  
   2.1 [–ß—Ç–æ –¥–µ–ª–∞–µ—Ç `DepthPath` –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω](#—á—Ç–æ-–¥–µ–ª–∞–µ—Ç-DepthPath-–∏-–∑–∞—á–µ–º-–æ–Ω-–Ω—É–∂–µ–Ω)  
   2.2 [–ß—Ç–æ —Ç–∞–∫–æ–µ `Accessor` –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω](#—á—Ç–æ-—Ç–∞–∫–æ–µ-Accessor-–∏-–∑–∞—á–µ–º-–æ–Ω-–Ω—É–∂–µ–Ω)  
   2.3 [–ß—Ç–æ —Ç–∞–∫–æ–µ `CacheKeys` –∏ –∑–∞—á–µ–º –æ–Ω–∏ –Ω—É–∂–µ–Ω](#—á—Ç–æ-—Ç–∞–∫–æ–µ-CacheKeys-–∏-–∑–∞—á–µ–º-–æ–Ω–∏-–Ω—É–∂–µ–Ω)

3. [API createObservableStore](#api-createobservablestore)  
   3.1. [`store.subscribe(callback, cacheKeys?)`](#storesubscribecallback-cachekeys)  
   3.2. [`store.subscribeToPath(pathOrAccessor, callback, options?)`](#storesubscribetopathpathoraccessor-callback-options)  
   3.3. [`store.invalidate(cacheKey)`](#storeinvalidatecachekey)  
   3.4. [`store.get(pathOrAccessor)`](#storegetpathoraccessor)  
   3.5. [`store.update(pathOrAccessor, valueOrFn, options)`](#storeupdatepathoraccessor-valueorfn-options)  
   3.6. [`store.resolveValue(pathOrAccessor, valueOrFn)`](#storeresolvevaluepathoraccessor-valueorfn)  
   3.7. [`store.resolvePath(pathOrAccessor)`](#storeresolvepathpathoraccessor)

4. [–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è](#–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)  
   4.1. [`store.asyncUpdate(pathOrAccessor, asyncUpdater, options?)`](#storeasyncupdatepathoraccessor-asyncupdater-options)  
   4.2. [`store.cancelAsyncUpdates(pathOrAccessor?)`](#storecancelasyncupdatespathoraccessor)

5. [–ë–∞—Ç—á–∏–Ω–≥ (`store.batch`)](#–±–∞—Ç—á–∏–Ω–≥-storebatch)

6. [–ò—Å—Ç–æ—Ä–∏—è (undo/redo)](#–∏—Å—Ç–æ—Ä–∏—è-undoredo)  
   6.1. [`store.undo(pathOrAccessor)`](#storeundopathoraccessor)  
   6.2. [`store.redo(pathOrAccessor)`](#storeredopathoraccessor)  
   6.4. [`store.getUndo(pathOrAccessor, step)`](#storegetundopathoraccessor-step)  
   6.3. [`store.getRedo(pathOrAccessor, step)`](#storegetredopathoraccessor-step)  
   6.5. [`store.getHistory(pathOrAccessor)`](#storegetHistorypathoraccessor)  
   6.6. [`store.clearHistoryPath(pathOrAccessor)`](#storeclearHistoryPathpathoraccessor)  
   6.7. [`store.clearAllHistory()`](#storeclearAllHistory)

7. [–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞](#—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞-–∏-–æ—á–∏—Å—Ç–∫–∞)  
   7.1. [`store.getMemoryStats()`](#storegetmemorystats)  
   7.2. [`store.clearStore()`](#storeclearstore)

8. [–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (Middleware)](#–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è-–æ–±—Ä–∞–±–æ—Ç–∫–∞-middleware)  
   8.1. [–ö–æ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç middleware](#1-–∫–æ–≥–¥–∞-—Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç-middleware)  
   8.2. [–ò–∑–º–µ–Ω–µ–Ω–∏–µ `value` –≤–Ω—É—Ç—Ä–∏ middleware](#2-–∏–∑–º–µ–Ω–µ–Ω–∏–µ-value-–≤–Ω—É—Ç—Ä–∏-middleware)  
   8.3. [–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è](#3-–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞-–∏–∑–º–µ–Ω–µ–Ω–∏—è)  
   8.4. [–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö middleware](#4-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å-–Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö-middleware)

9. [–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–∞–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞-—Ç–∞–∫–æ–≥–æ-–ø–æ–¥—Ö–æ–¥–∞)

10. [–í—ã–≤–æ–¥](#–≤—ã–≤–æ–¥)

---

–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥—ë–Ω –ø—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å—Ç–æ—Ä–∞ (ObservableStore), –Ω–∞–ø–∏—Å–∞–Ω–Ω–æ–≥–æ –Ω–∞ TypeScript –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ñ—Ä–µ–π–º–≤–æ—Ä–∫—É. –¢–∞–∫–æ–π —Å—Ç–æ—Ä –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ ¬´–ø–æ–¥–∫–ª—é—á–∏—Ç—å¬ª –≤ –ª—é–±–æ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–µ (React, Vue, Svelte, Solid –∏ —Ç. –¥.) –ø—É—Ç—ë–º –Ω–∞–ø–∏—Å–∞–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–±—ë—Ä—Ç–æ–∫ (–∞–¥–∞–ø—Ç–µ—Ä–æ–≤) –ø–æ–≤–µ—Ä—Ö –±–∞–∑–æ–≤–æ–≥–æ API.

- –û–±–µ—Ä—Ç–∫–∞ –ø–æ–¥ react: [@qtpy/state-management-react](https://www.npmjs.com/package/@qtpy/state-management-react)

---

## –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

1. #### –ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
   –†–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É –ø–æ–¥–ø–∏—Å–æ–∫ –∏ JavaScript Proxy:

    - **–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫**: –•—Ä–∞–Ω–∏—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ (`subscribers`, `pathSubscribers`) –∏ —É–≤–µ–¥–æ–º–ª—è–µ—Ç –∏—Ö –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö —á–µ—Ä–µ–∑ `notifyInvalidate`. –†–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø—Ä–æ–∫—Å–∏, –∏—Å–ø–æ–ª—å–∑—É—è `getRaw` –∏ `setRaw`.
    - **–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–∫—Å–∏**: –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è (`get`), –∑–∞–ø–∏—Å–∏ (`set`) –∏ —É–¥–∞–ª–µ–Ω–∏—è, —Å–æ–±–∏—Ä–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ `trackedPaths` –∏ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ `store.update`, —É–≤–µ–¥–æ–º–ª—è—è –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤.
    - **–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ**: –ü–æ–¥–ø–∏—Å–∫–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã, –ø—Ä–æ–∫—Å–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∏—Ö –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π. Middleware –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è –≤ —Ü–µ–ø–æ—á–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.

2. #### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∫–ª—é—á–µ–π

   - –í ObservableStore —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å—Ç—Ä–æ–≥–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ø—É—Ç–µ–π, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç:
   - –±–µ–∑–æ–ø–∞—Å–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç—Ä–æ–∫–∏ –ø—É—Ç–µ–π –≤—Ä–æ–¥–µ "user.settings.theme" –±–µ–∑ —Ä–∏—Å–∫–∞ –æ—à–∏–±–æ–∫ —Ç–∏–ø–æ–≤;
   - –ø–æ–ª—É—á–∞—Ç—å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—É—Ç–µ–π –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ TypeScript;
   - –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø—É—Ç–∏ –∏ –∑–Ω–∞—á–µ–Ω–∏—è: –µ—Å–ª–∏ –ø—É—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω ‚Äî TypeScript –ø–æ–¥—Å–∫–∞–∂–µ—Ç –æ–± –æ—à–∏–±–∫–µ –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏;
   - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–æ—Ä—Ç–µ–∂–∞–º –∏ –º–∞—Å—Å–∏–≤–∞–º –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º, –Ω–∞–ø—Ä–∏–º–µ—Ä: "items.0" –∏–ª–∏ "list.2.name".

   - –ø—Ä–∏–º–µ—Ä: [—Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É](https://raw.githubusercontent.com/TheOnlyFastCoder2/QtPy-library/refs/heads/main/state-management/main/packages/observable/assets/picture_autocomplete.png)

     <img src="https://raw.githubusercontent.com/TheOnlyFastCoder2/QtPy-library/refs/heads/main/state-management/main/packages/observable/assets/picture_autocomplete.png" width="1200"/>

3. #### –ü–æ–¥–ø–∏—Å–∫–∏ —Å ¬´–≥—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—å—é¬ª –ø—É—Ç–µ–π

   - –ú–æ–∂–Ω–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ª—é–±–æ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø–æ–ª–µ –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É—è –ª–∏–±–æ —Å—Ç—Ä–æ–∫—É-–ø—É—Ç—å (`"user.settings.theme"`), –ª–∏–±–æ Accessor: `($, t) => $.user.settings.theme`.
   - –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏–º–µ–Ω–Ω–æ —ç—Ç–æ–≥–æ –ø–æ–ª—è –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –ø–æ–ª—É—á–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—è—Ö –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç —ç—Ç—É –ø–æ–¥–ø–∏—Å–∫—É.

4. #### –ö—ç—à-–∫–ª—é—á–∏ (cacheKeys)

   - –ü–æ–∑–≤–æ–ª—è—é—Ç –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å ¬´–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏¬ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞).
   - –ü—Ä–∏ –≤—ã–∑–æ–≤–µ `store.invalidate(key)` –≤—Å–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏, –ø–µ—Ä–µ–¥–∞–≤—à–∏–µ —ç—Ç–æ—Ç `cacheKey` –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∫–µ, –±—É–¥—É—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω—ã, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –ø–æ–ª–µ –æ—Å—Ç–∞–ª—Å—è —Ç–µ–º –∂–µ.

5. #### Middleware-–ø–æ–¥—Ö–æ–¥

   - –ü—Ä–∏ –∫–∞–∂–¥–æ–º `update` (–∏–ª–∏ –ø—Ä—è–º–æ–π –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ Proxy) –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ü–µ–ø–æ—á–∫—É middleware, —á—Ç–æ–±—ã –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å, –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è.
   - –ö–∞–∂–¥—ã–π middleware –≤–∏–¥–∏—Ç –ø—É—Ç—å (`string`) –∏ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –º–æ–∂–µ—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ.

6. #### Batching-–æ–±—ë—Ä—Ç–∫–∞

   - –ü–æ–∑–≤–æ–ª—è–µ—Ç ¬´—Å–∫–ª–µ–∏–≤–∞—Ç—å¬ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –æ–¥–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ. –≠—Ç–æ –≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã –Ω–µ –≤—ã–∑—ã–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–π —Ä–µ—Ä–µ–Ω–¥–µ—Ä UI –ø—Ä–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö.

7. #### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

   - –ú–µ—Ç–æ–¥ `asyncUpdate(pathOrAccessor, asyncFn, options?)` –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (fetch, —Ç–∞–π–º–µ—Ä—ã, –∑–∞–ø—Ä–æ—Å—ã) –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–º–µ–Ω—è—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ, –µ—Å–ª–∏ –æ–Ω–∏ –≤—Å—ë –µ—â—ë –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ (–æ–ø—Ü–∏—è `abortPrevious`).

8. #### –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (undo/redo)

   - –î–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –≤ `customLimitsHistory` —Å–≤–æ–π—Å—Ç–≤ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å –∑–∞–¥–∞–Ω–Ω—ã–º –ª–∏–º–∏—Ç–æ–º.
   - –ú–µ—Ç–æ–¥—ã `undo(pathOrAccessor)` –∏ `redo(pathOrAccessor)` –ø–æ–∑–≤–æ–ª—è—é—Ç –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ/—Å–ª–µ–¥—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è.

9. #### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ª—é–±—ã–º —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–º

   - –ë–∞–∑–æ–≤–æ–µ API —Å—Ç–æ—Ä–∞ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç React/Vue –∏ —Ç.‚Ää–¥.
   - –î–ª—è React –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å —Ö—É–∫ `useObservableStore`, –∫–æ—Ç–æ—Ä—ã–π –≤–Ω—É—Ç—Ä–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `store.subscribeToPath` —Å Accessor‚Äô–æ–º, –∏ –¥–∏—Å–ø–∞—Ç—á–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è Vue/Svelte/Solid –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –∞–¥–∞–ø—Ç–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ Proxy –≤—ã–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ.

---

## –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ `store` (—Å middleware)

```ts
// ObservableStore.ts
import { createObservableStore, Middleware } from '@qtpy/state-management-observable';
// 1) –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π interface :
interface StoreState {
  user: {
    name: string;
    age: number;
    settings: {
      theme: string;
      locale: string;
    };
  };
  items: number[];
  counter: number;
}

// 2) –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —Å—Ç–µ–π—Ç:
const initialState = {
  user: {
    name: 'Alice',
    age: 30,
    settings: {
      theme: 'light',
      locale: 'ru',
    },
  },
  items: [1, 2, 3],
  counter: 0,
};
// 3) –ì–ª—É–±–∏–Ω–∞ —Ç–∏–ø –ø–æ–∏—Å–∫–∞ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ø—É—Ç–µ–π
type DepthPath = 14;
// 3) –ü—Ä–∏–º–µ—Ä middleware: –ø—Ä–æ—Å—Ç–æ–π –ª–æ–≥–≥–µ—Ä –ø–µ—Ä–µ–¥ –∏ –ø–æ—Å–ª–µ update
const loggerMiddleware: Middleware<StoreState, DepthPath> = (store, next) => {
  return (path, value) => {
    console.log(`[Logger] –î–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: –ø—É—Ç—å="${path}", —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ=`, store.get(path));
    next(path, value);
    console.log(`[Logger] –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: –ø—É—Ç—å="${path}", –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ=`, store.get(path));
  };
};

// 3) –°–æ–∑–¥–∞—ë–º —Å—Ç–æ—Ä —Å middleware –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –∏—Å—Ç–æ—Ä–∏–∏:
export const store = createObservableStore<StoreState, DepthPath>(
  initialState,
  [loggerMiddleware], // —Ü–µ–ø–æ—á–∫–∞ middleware
  {
    customLimitsHistory: [
      // –î–ª—è —Å–≤–æ–π—Å—Ç–≤–∞ counter —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–æ 3 –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π
      ['counter', 3],
      // –î–ª—è locale ‚Äî –¥–æ 2 —Å–æ—Å—Ç–æ—è–Ω–∏–π
      ['user.settings.locale', 2],
      // –î–ª—è 4-–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –º–∞—Å—Å–∏–≤–∞ items —á–µ—Ä–µ–∑ –∞–∫—Å—Ü–µ—Å—Å–æ—Ä ‚Äî –¥–æ 3 —Å–æ—Å—Ç–æ—è–Ω–∏–π
      [($) => $.items[3], 3],
      // –î–ª—è –≤—Å–µ–≥–æ –º–∞—Å—Å–∏–≤–∞ items ‚Äî –¥–æ 3 —Å–æ—Å—Ç–æ—è–Ω–∏–π
      [($) => $.items, 3],
    ],
  }
);

// –¢–µ–ø–µ—Ä—å –ø—Ä–∏ –≤—ã–∑–æ–≤–µ store.update(...) –∏–ª–∏ –ø—Ä–∏ –ø—Ä—è–º–æ–π –∑–∞–ø–∏—Å–∏ –≤ store.state
// —Å—Ä–∞–±–æ—Ç–∞—é—Ç middleware –∏, –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏, —É–≤–µ–¥–æ–º—è—Ç—Å—è –ø–æ–¥–ø–∏—Å—á–∏–∫–∏.
```

## API `createObservableStore`

### `store.subscribe(callback, cacheKeys?)`

–≠—Ç–æ –º–µ—Ç–æ–¥ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –ª—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏, –≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞—Ç—Ä–æ–Ω—É—Ç–æ–≥–æ –ø–æ–ª—è. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–æ—Ä–∞. –ü—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ –º–∞—Å—Å–∏–≤–∞ `cacheKeys`, –ø–æ–¥–ø–∏—Å–∫–∞ –±—É–¥–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö, –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—â–∏—Ö —É–∫–∞–∑–∞–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏. –≠—Ç–æ —É–¥–æ–±–Ω–æ –¥–ª—è –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è, –∞–Ω–∞–ª–∏—Ç–∏–∫–∏, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –¥–æ–ª–∂–Ω–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ª—é–±—ã–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è.

- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

  1. `callback: (state) => void` ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ ¬´–±–∞—Ç—á–∞¬ª –∏–∑–º–µ–Ω–µ–Ω–∏–π.
  2. `cacheKeys?: string[]` ‚Äî –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∫–ª—é—á–µ–π (cacheKey). –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏–¥—ë—Ç —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞:

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –≤—Å–µ –∞–ø–¥–µ–π—Ç—ã:
  const unsubAll = store.subscribe((fullState) => {
    console.log('–í–µ—Å—å —Å—Ç–µ–π—Ç –∏–∑–º–µ–Ω–∏–ª—Å—è:', fullState);
  });

  // –ü–æ–¥–ø–∏—Å–∫–∞, –æ–ø–∏—Ä–∞—é—â–∞—è—Å—è –Ω–∞ cacheKey "user.settings.theme":
  const unsubFiltered = store.subscribe(
    (fullState) => console.log('–¢–µ–º–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', fullState.user.settings.theme),
    ['user.settings.theme']
  );

  // –û—Ç–ø–∏—Å–∫–∞:
  unsubAll();
  unsubFiltered();
  ```

---

### `store.subscribeToPath(pathOrAccessor, callback, options?)`

subscribeToPath –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏, —É–∫–∞–∑–∞–≤ –ø—É—Ç—å –∫–∞–∫ —Å—Ç—Ä–æ–∫—É –∏–ª–∏ Accessor-—Ñ—É–Ω–∫—Ü–∏—é. –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —Ç–æ—á–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é.

- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

  1. `pathOrAccessor`
  2. `callback: (newValue) => void` ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø—É—Ç–∏.
  3. `options?: { immediate?: boolean; cacheKeys?: string[] }` ‚Äî
     - `immediate: true` ‚Äî —Å—Ä–∞–∑—É –≤—ã–∑—ã–≤–∞–µ–º callback —Å —Ç–µ–∫—É—â–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º, –¥–∞–∂–µ –¥–æ –ø–µ—Ä–≤–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è.
     - `cacheKeys: string[]` ‚Äî —Å–ø–∏—Å–æ–∫ cacheKeys; –∫–æ–ª–±—ç–∫ –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –ø—Ä–∏ —ç—Ç–æ–º —Å–æ–±—ã—Ç–∏–∏, –¥–∞–∂–µ –µ—Å–ª–∏ –ø—É—Ç—å –Ω–µ –º–µ–Ω—è–ª—Å—è –Ω–∞–ø—Ä—è–º—É—é (—Å–º. `store.invalidate`).

- **–ü—Ä–∏–º–µ—Ä—ã:**

  ```ts
  // 1) –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ user.name –ø–æ —Å—Ç—Ä–æ–∫–æ–≤–æ–º—É –ø—É—Ç–∏:
  const unsubName = store.subscribeToPath('user.name', (newName) => console.log('–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', newName), {
    immediate: true,
  });

  // 2) –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞ items:
  //    –ó–¥–µ—Å—å index –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤–Ω—É—Ç—Ä–∏ Accessor —á–µ—Ä–µ–∑ t(index)
  let idx = 0;
  const unsubFirstItem = store.subscribeToPath(
    ($, t) => $.items[t(idx)], // Accessor<any>
    (val) => console.log('–ü–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞:', val),
    { cacheKeys: ['counter'] }
  );

  // 3) –û—Ç–ø–∏—Å–∫–∞:
  unsubName();
  unsubFirstItem();
  ```

---

### `store.invalidate(cacheKey)`

–ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–π —Å—Ç—Ä–æ–∫–æ–≤—ã–π –∫–ª—é—á (`cacheKey`). –í—Å–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∫–µ –ø–µ—Ä–µ–¥–∞–ª–∏ —ç—Ç–æ—Ç –∫–ª—é—á –≤ `cacheKeys`, –ø—Ä–∏–¥—ë—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–¥–∞–∂–µ –µ—Å–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –∏—Ö –ø—É—Ç–∏ –Ω–µ –º–µ–Ω—è–ª–æ—Å—å).

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  // –ï—Å–ª–∏ –≥–¥–µ-—Ç–æ –≤ –ª–æ–≥–∏–∫–µ –Ω—É–∂–Ω–æ —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞—Ç—å –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ –ø–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º, –ø–æ–ª–∞–≥–∞—é—â–∏–º—Å—è –Ω–∞ cacheKey:
  store.invalidate('user.settings.theme');
  ```

---

### `store.get(pathOrAccessor)`

–ú–µ—Ç–æ–¥ store.get(pathOrAccessor) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Å—Ç–æ—Ä–∞ ‚Äî –ø–æ —Å—Ç—Ä–æ–∫–æ–≤–æ–º—É –ø—É—Ç–∏ ("user.age") –∏–ª–∏ Accessor-—Ñ—É–Ω–∫—Ü–∏–∏. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ $.myObject, –æ–Ω –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–∂–µ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏, –ø—Ä–æ–∫—Å—è–º–∏ –∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏. –≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ,`—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ –≤—Ä–æ–¥–µ Uncaught TypeError: Illegal invocation`, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –Ω–∞—Ç–∏–≤–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ DOM –∏–ª–∏ —Ä–∞–±–æ—Ç—ã —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ –≤–Ω–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –ú–µ—Ç–æ–¥ —Ç–∞–∫–∂–µ —É–ª—É—á—à–∞–µ—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å, —Ç–∏–ø–∏–∑–∞—Ü–∏—é –∏ –¥–µ–ª–∞–µ—Ç –∫–æ–¥ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º –ø—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏.

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  const age = store.get('user.age'); // 30
  console.log('–í–æ–∑—Ä–∞—Å—Ç:', age);

  // –ü—Ä–∏–º–µ—Ä —Å Accessor: —á–∏—Ç–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞ –ø–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–º—É –∏–Ω–¥–µ–∫—Å—É
  let idx = 1;
  const firstItem = store.get(($, t) => $.items[t(idx)]);
  console.log('–í—Ç–æ—Ä–æ–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞:', firstItem); // 2
  ```

---

### `store.update(pathOrAccessor, valueOrFn, options)`

–ú–µ—Ç–æ–¥ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. –û–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç:

- `pathOrAccessor`: —Å—Ç—Ä–æ–∫—É —Ç–∏–ø–∞ `"user.age"` –∏–ª–∏ Accessor-—Ñ—É–Ω–∫—Ü–∏—é
- `valueOrFn`: –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏—é `(cur) => next`
- `options`: –æ–±—ä–µ–∫—Ç —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, –≤–∫–ª—é—á–∞—è `keepQuiet`

---

#### –ú–µ—Ö–∞–Ω–∏–∑–º Snapshot –ø–µ—Ä–µ–¥/–ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

–ü—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ `update()`:

- –ü–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–Ω–∏–º–æ–∫ (snapshot) —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ–±—ä–µ–∫—Ç–∞ –∏–ª–∏ –º–∞—Å—Å–∏–≤–∞ –±–µ–∑ –∏–Ω—Å—Ç–∞–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞.
- –°—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏—é (–¥–æ `maxHistoryLength`).
- –ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è middleware (–≤ –ø–æ—Ä—è–¥–∫–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏).
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ.
- –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –Ω–æ–≤—ã–π —Å–Ω–∏–º–æ–∫ –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è —Ö–µ—à–∏ —Å—Ç–∞—Ä–æ–≥–æ –∏ –Ω–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏–π, —á—Ç–æ–±—ã —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å.
- –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ —É–≤–µ–¥–æ–º–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –æ—Ç–ª–∏—á–∏—è—Ö –≤ –¥–∞–Ω–Ω—ã—Ö.

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

- –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–∏—à–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
- –û–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É undo/redo
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –¥–µ–±–∞–≥–∞

---

#### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º—É—Ç–∞—Ü–∏–π –º–∞—Å—Å–∏–≤–æ–≤ —á–µ—Ä–µ–∑ Proxy

–î–∞–∂–µ –∫–æ—Å–≤–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥—ã `push`, `splice`, `sort` –∏ –¥—Ä—É–≥–∏–µ ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è:

- –í—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ `store.$`, –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è `Proxy`
- –ò–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥—ã ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞—é—Ç `store.update(...)`
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—è, middleware, –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

–ü—Ä–∏–º–µ—Ä—ã:

```ts
store.$.items.push(100); // –≤—ã–∑–æ–≤–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
store.$.items.splice(1, 2); // ‚Üí –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ "items"
store.$.user.name = 'Charlie'; // ‚Üí –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ "user.name"
```

---

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `update()` ‚Äî –≤–∞—Ä–∏–∞–Ω—Ç—ã

1. **–ü–æ —Å—Ç—Ä–æ–∫–æ–≤–æ–º—É –ø—É—Ç–∏**:

```ts
store.update('user.age', 35);
```

2. **–ß–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é**:

```ts
store.update('user.age', (cur) => cur + 1);
```

3. **–° `keepQuiet`** ‚Äî —á—Ç–æ–±—ã –Ω–µ —É–≤–µ–¥–æ–º–ª—è—Ç—å –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤:

```ts
store.update('user.age', 36, { keepQuiet: true });
store.update.quiet('user.age', 36);
```

4. **–ß–µ—Ä–µ–∑ Accessor —Å –¥–∏–Ω–∞–º–∏–∫–æ–π**:

```ts
let idx = 2;
store.update(
  ($, t) => $.items[t(idx)],
  (cur) => cur * 10
);
```

5. **–ú–∞—Å—Å–∏–≤ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ snapshot**:

```ts
store.update('items', (prev) => {
  return prev.reverse(); // –≤—ã–∑–æ–≤–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
});
store.update('items', (prev) => {
  return prev; // –Ω–µ –≤—ã–∑–æ–≤–µ—Ç ‚Äî snapshot –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è
});
```

---

### `store.resolvePath(pathOrAccessor)`

`resolvePath` –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –ø—É—Ç—å –∫ –¥–∞–Ω–Ω—ã–º (—Å—Ç—Ä–æ–∫—É –≤–∏–¥–∞ `'a.b'` –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏—é `$ => $.a.b`) –≤ —Å—Ç—Ä–æ–∫–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –ø—É—Ç–∏ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≥–ª—É–±–∏–Ω–µ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏.

**–ú–æ–∂–µ—Ç –ø—Ä–∏–≥–æ–¥–∏—Ç—å—Å—è –≤ Middleware**

- **–ü—Ä–∏–º–µ—Ä:**

```ts
store.resolvePath('user.name'); // ‚Üí 'user.name'
store.resolvePath(($) => $.profile.age); // ‚Üí 'profile.age'
```

---

### `store.resolveValue(pathOrAccessor, valueOrFn)`

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ "–ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞" –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è. –û–Ω —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç, –∫–∞–∫–∏–º –±—É–¥–µ—Ç –∏—Ç–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ –ø—Ä—è–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è, –Ω–µ –º–µ–Ω—è—è –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç–æ—Ä–µ. –≠—Ç–æ —É–¥–æ–±–Ω–æ, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —É—Å–ª–æ–≤–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É, –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é, —Å—Ä–∞–≤–Ω–∏—Ç—å —Å —Ç–µ–∫—É—â–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º –∏–ª–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –Ω–µ —Ä–∏—Å–∫—É—è —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏ –∏–ª–∏ —Ä–µ—Ä–µ–Ω–¥–µ—Ä—ã.

**–ú–æ–∂–µ—Ç –ø—Ä–∏–≥–æ–¥–∏—Ç—å—Å—è –≤ Middleware**

- **–ü—Ä–∏–º–µ—Ä:**

```ts
const nextCounter = store.resolveValue('counter', (cur) => cur + 5);
console.log('–ë—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π counter:', nextCounter);
// –ù–æ store.get("counter") –æ—Å—Ç–∞—ë—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º.
```

---

## –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### `store.asyncUpdate(pathOrAccessor, asyncUpdater, options?)`

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è - –ø–æ–ª–µ–∑–Ω–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∑–∞–ø—Ä–æ—Å. –ü—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–π –æ–ø—Ü–∏–∏ `abortPrevious: true`, –≤—Å–µ –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ —Ç–æ–º—É –∂–µ –ø—É—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç—Å—è, –∏—Å–∫–ª—é—á–∞—è –≥–æ–Ω–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –≠—Ç–æ —É–¥–æ–±–Ω–æ –ø—Ä–∏ –≤–≤–æ–¥–µ –≤ –ø–æ–ª–µ, –¥–µ–±–∞—É–Ω—Å–µ, —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –∏–ª–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

- –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω `options.abortPrevious: true`, –ø—Ä–µ–¥—ã–¥—É—â–∏–π –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ —Ç–æ–º—É –∂–µ –ø—É—Ç–∏ –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω—ë–Ω –ø—Ä–∏ –ø–æ–º–æ—â–∏ `AbortController`.

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  // –ó–∞–≥—Ä—É–∑–∏–º —Å–ø–∏—Å–æ–∫ —Å —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∑–∞–ø–∏—à–µ–º –≤ $.items:
  await store.asyncUpdate(
    'items',
    async (currentItems, signal) => {
      const response = await fetch('/api/items', { signal });
      const data = await response.json();
      return data.list;
    },
    { abortPrevious: true }
  );
  ```

---
### `store.asyncUpdate.quiet(pathOrAccessor, asyncUpdater, options?)`

–í–∞—Ä–∏–∞–Ω—Ç `asyncUpdate`, –∫–æ—Ç–æ—Ä—ã–π **–Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏**. –≠—Ç–æ —É–¥–æ–±–Ω–æ –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –¥–æ–ª–∂–Ω—ã –≤—ã–∑—ã–≤–∞—Ç—å —Ä–µ–∞–∫—Ü–∏—é –≤ UI.


- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  // –í—Ä–µ–º–µ–Ω–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º $.status = 'loading', –±–µ–∑ —Ç—Ä–∏–≥–≥–µ—Ä–∞ –ø–æ–¥–ø–∏—Å–æ–∫
  await store.asyncUpdate.quiet(
    'status',
    async (_, signal) => {
      await new Promise((resolve, reject) => {
        const timeout = setTimeout(resolve, 1000);
        signal.addEventListener('abort', () => {
          clearTimeout(timeout);
          reject(new DOMException('Aborted', 'AbortError'));
        });
      });
      return 'idle';
    },
    { abortPrevious: true }
  );
  ```
---

### `store.cancelAsyncUpdates(pathOrAccessor?)`

–ú–µ—Ç–æ–¥ –¥–ª—è –æ—Ç–º–µ–Ω—ã –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π, –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ asyncUpdate. –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—É—Ç—å, –æ—Ç–º–µ–Ω—è—é—Ç—Å—è –∑–∞–ø—Ä–æ—Å—ã —Ç–æ–ª—å–∫–æ –ø–æ –Ω–µ–º—É; –µ—Å–ª–∏ –≤—ã–∑–≤–∞—Ç—å –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ ‚Äî –∑–∞–≤–µ—Ä—à–∞—Ç—Å—è –≤—Å–µ ¬´–≤–∏—Å—è—â–∏–µ¬ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–æ –≤—Å—ë–º —Å—Ç–æ—Ä–µ. –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö, –≥–æ–Ω–æ–∫, –∏–ª–∏ –ª–∏—à–Ω–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —ç–∫—Ä–∞–Ω–∞, logout'–µ, –∏–ª–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤–≤–æ–¥–µ –¥–∞–Ω–Ω—ã—Ö.

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  // –û—Ç–º–µ–Ω–∏—Ç—å –≤—Å–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
  store.cancelAsyncUpdates();

  // –û—Ç–º–µ–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—É—Ç–∏ "items":
  store.cancelAsyncUpdates('items');
  ```

---

## –ë–∞—Ç—á–∏–Ω–≥ (`store.batch`)

### `store.batch(callback)`

–ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –æ–¥–∏–Ω —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π –±–ª–æ–∫, –ø—Ä–∏ —ç—Ç–æ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π. –≠—Ç–æ —É–º–µ–Ω—å—à–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏—à–Ω–∏—Ö —Ä–µ—Ä–µ–Ω–¥–µ—Ä–æ–≤, —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –¥–µ–ª–∞–µ—Ç –ª–æ–≥–∏–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –±–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–π. –û—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–æ –ø—Ä–∏ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–µ–π –±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–µ–∞–∫—Ü–∏–π.

- **–ü—Ä–∏–º–µ—Ä—ã:**

  ```ts
  // 1) –ß–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ update:
  await store.batch(() => {
    store.update('user.name', 'Charlie');
    store.update('user.age', (cur) => cur + 2);
    store.update('items.0', 100);
    store.update('items.0', 200); // –¥–≤–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –ø—É—Ç–∏
  });
  // –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ –ø–æ–ª—É—á–∞—Ç –æ–¥–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:
  // - user.name = "Charlie"
  // - user.age = previous + 2
  // - items.0 = 200  (—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ)

  // 2) –° –ø—Ä—è–º—ã–º–∏ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏—è–º–∏:
  await store.batch(() => {
    store.$.user.name = 'Charlie';
    store.$.user.age = 23;
    store.$.items[0] = 100;
    store.$.items[0] = 200; // –¥–≤–∞ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏—è
  });
  // –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ —É–≤–∏–¥—è—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è:
  // "user.name", "user.age", "items.0" ‚Äî —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º 200
  ```

---

## –ò—Å—Ç–æ—Ä–∏—è (undo/redo)

–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (undo/redo) –Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å–æ—Å—Ç–æ—è–Ω–∏—è. –ß—Ç–æ–±—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å–≤–æ–π—Å—Ç–≤, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –∏—Ö –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ customLimitsHistory –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞.

```ts
const store = createObservableStore<AppState, DepthPath>(initialState, [], {
  customLimitsHistory: [
    ['user.age', 5], // [path, –ª–∏–º–∏—Ç]
    [($) => $.items[0], 3], // [accessor, –ª–∏–º–∏—Ç]
  ],
});
```

- **–í–∞–∂–Ω–æ:** –∏—Å—Ç–æ—Ä–∏—è –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∫–æ—Å–≤–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–∞—Å—Å–∏–≤–æ–≤ —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `store.$.items.push(23)`), –ø–æ—ç—Ç–æ–º—É —Ç–∞–∫–∏–µ –ø—Ä–∞–≤–∫–∏ **–Ω–µ** –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Å—Ç–µ–∫ `undo/redo`.

### `store.undo(pathOrAccessor)`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç (undo) –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –ø—É—Ç–∏ (–∏–ª–∏ Accessor).

  - –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∞—è –∑–∞–ø–∏—Å—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true` –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ. –ò–Ω–∞—á–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `false`.

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  store.update('counter', 10);
  store.update('counter', 20);

  console.log(store.get('counter')); // 20
  store.undo('counter');
  console.log(store.get('counter')); // 10
  ```

---

### `store.redo(pathOrAccessor)`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ø–æ–≤—Ç–æ—Ä—è–µ—Ç (redo) –ø–æ—Å–ª–µ–¥–Ω–µ–µ –æ—Ç–∫–∞—Ç–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –ø—É—Ç–∏.

  - –ï—Å–ª–∏ –µ—Å—Ç—å ¬´–æ—Ç–º–µ–Ω—ë–Ω–Ω–æ–µ¬ª –∑–Ω–∞—á–µ–Ω–∏–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true` –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –µ–≥–æ. –ò–Ω–∞—á–µ `false`.

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  // –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø—Ä–∏–º–µ—Ä–∞:
  store.undo('counter'); // –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫ 10
  store.redo('counter');
  console.log(store.get('counter')); // 20
  ```

---

–í–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ —Ç–∞–∫–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è –º–µ—Ç–æ–¥–æ–≤ `store.getUndo`, `store.getRedo` –∏ `store.getHistory`:

---

### `store.getUndo(pathOrAccessor, step)`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ undo-–∏—Å—Ç–æ—Ä–∏–∏ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –Ω–∞–∑–∞–¥ –ø–æ –ø—É—Ç–∏ `pathOrAccessor`.

  - `step = 0` ‚Äî —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.
  - `step = 1` ‚Äî –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.
  - –ï—Å–ª–∏ —à–∞–≥ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã undo-–∏—Å—Ç–æ—Ä–∏–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `undefined`.

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  store.$.counter = 10;
  store.$.counter = 20;
  store.$.counter = 30;

  store.getUndo('counter', 0); // 30
  store.getUndo('counter', 1); // 20
  store.getUndo('counter', 2); // 10
  store.getUndo('counter', 3); // undefined
  ```

---

### `store.getRedo(pathOrAccessor, step)`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ redo-–∏—Å—Ç–æ—Ä–∏–∏ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –≤–ø–µ—Ä—ë–¥ –ø–æ –ø—É—Ç–∏ `pathOrAccessor`.

  - `step = 0` ‚Äî –±–ª–∏–∂–∞–π—à–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–∞.
  - `step = 1` ‚Äî —Å–ª–µ–¥—É—é—â–µ–µ –∑–∞ –Ω–∏–º –∏ —Ç.–¥.
  - –ï—Å–ª–∏ redo-–∏—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞ –∏–ª–∏ —à–∞–≥ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `undefined`.

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  store.update('counter', 10);
  store.update('counter', 20);
  store.undo('counter'); // –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫ 10
  store.undo('counter'); // –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫ undefined

  store.getRedo('counter', 0); // 10
  store.getRedo('counter', 1); // 20
  store.getRedo('counter', 2); // undefined
  ```

---

### `store.getHistory(pathOrAccessor)`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –ø—É—Ç–∏ –≤ –≤–∏–¥–µ –æ–±—ä–µ–∫—Ç–∞ `{ undo, redo }`.

  - `undo` ‚Äî –º–∞—Å—Å–∏–≤ –∑–Ω–∞—á–µ–Ω–∏–π, –æ—Ç —Å–∞–º–æ–≥–æ –ø–µ—Ä–≤–æ–≥–æ –¥–æ —Ç–µ–∫—É—â–µ–≥–æ.
  - `redo` ‚Äî –º–∞—Å—Å–∏–≤ –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π, –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è.

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  store.update('counter', 10);
  store.update('counter', 20);
  store.undo('counter');

  const history = store.getHistory('counter');
  console.log(history.undo); // [10]
  console.log(history.redo); // [20]
  ```

---

### `store.clearHistoryPath(pathOrAccessor)`

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –¥–ª—è —Ç–æ—á–µ—á–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π (undo/redo stack) –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è. –û–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø—É—Ç–∏, –Ω–æ –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç —Å–∞–º–æ —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å—Ç–æ—Ä–µ.

- **–ü—Ä–∏–º–µ—Ä:**

```ts
store.clearHistoryPath('user.age'); // –∏–ª–∏
store.clearHistoryPath(($) => $.user.age);
```

### `store.clearAllHistory()`

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–±—Ä–æ—Å–∞ –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤–æ –≤—Å—ë–º —Å—Ç–æ—Ä–µ. –£–¥–∞–ª—è–µ—Ç –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è undo/redo –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

- **–ü—Ä–∏–º–µ—Ä:**

```ts
store.clearAllHistory();
```

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞

### `store.getMemoryStats()`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Å —Ç–µ–∫—É—â–∏–º–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏:

  - `subscribersCount` ‚Äî —á–∏—Å–ª–æ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤.
  - `pathSubscribersCount` ‚Äî —á–∏—Å–ª–æ –ø–æ–¥–ø–∏—Å–æ–∫ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –ø—É—Ç—è–º/Accessor‚Äô–∞–º.
  - `historyEntries` ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—É—Ç–µ–π –∏ –¥–ª–∏–Ω–∞ –∏—Ö –∏—Å—Ç–æ—Ä–∏–∏.
  - `activePathsCount` ‚Äî —á–∏—Å–ª–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—É—Ç–µ–π (–∑–∞ –∫–æ—Ç–æ—Ä—ã–º–∏ –∫—Ç–æ-—Ç–æ —Å–ª–µ–¥–∏—Ç).

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  const stats = store.getMemoryStats();
  console.log('–ì–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤:', stats.subscribersCount);
  console.log('–ü–æ–¥–ø–∏—Å–æ–∫ –ø–æ –ø—É—Ç—è–º:', stats.pathSubscribersCount);
  console.log('–ò—Å—Ç–æ—Ä–∏—è:', stats.historyEntries);
  ```

---

### `store.clearStore()`

- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:

  - –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –ø–æ–¥–ø–∏—Å–∫–∏ (–≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∏ –ø–æ –ø—É—Ç—è–º).
  - –û—Ç–º–µ–Ω—è–µ—Ç –≤—Å–µ ¬´–≤–∏—Å—è—â–∏–µ¬ª –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.
  - –û—á–∏—â–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é.

- **–ü—Ä–∏–º–µ—Ä:**

  ```ts
  // –ö–æ–≥–¥–∞ —Å—Ç–æ—Ä –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω:
  store.clearStore();
  ```

---

## –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (Middleware)

`Middleware` ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ ¬´–æ–±–æ—Ä–∞—á–∏–≤–∞—é—Ç¬ª –≤—ã–∑–æ–≤—ã `store.update(...)` –∏ –¥–∞—é—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å (–º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å, –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å, –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å) –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è.

### 1. –ö–æ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç middleware

- Middleware –≤—ã–∑—ã–≤–∞—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ** –ø—Ä–∏:

  1. –≤—ã–∑–æ–≤–µ `store.update(...)`, –∏–ª–∏
  2. –ø—Ä—è–º–æ–π –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ Proxy (`store.$.some.key = newValue`).

- –ï—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±–æ–π—Ç–∏ Proxy (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞–ø—Ä—è–º—É—é –ø–æ–º–µ–Ω—è—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ¬´—Å—ã—Ä–æ–π¬ª –æ–±—ä–µ–∫—Ç –≤–Ω–µ Proxy), middleware –Ω–µ –∑–∞–ø—É—Å—Ç—è—Ç—Å—è.

```ts
// –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è middleware:
store.update('user.name', 'Dmitry');
store.$.user.name = 'Dmitry'; // Proxy –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∏ –∏–¥—ë—Ç —á–µ—Ä–µ–∑ middleware

// –ù–ï –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç middleware (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
// (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ¬´—Å—ã—Ä—ã–π¬ª –æ–±—ä–µ–∫—Ç –∑–¥–µ—Å—å –Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç Proxy)
(store as any).rawState.user.name = 'Eve';
```

---

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ `value` –≤–Ω—É—Ç—Ä–∏ middleware

–í–Ω—É—Ç—Ä–∏ middleware –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É `path` –∏ `value`. –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å `value` –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –ø–µ—Ä–µ–¥–∞—Ç—å –µ–≥–æ –¥–∞–ª—å—à–µ –ø–æ —Ü–µ–ø–æ—á–∫–µ, –≤—ã–∑–≤–∞–≤ `next(path, newValue)`.

```ts
const clampAgeMiddleware: Middleware<typeof initialState> = (store, next) => {
  return (path, value) => {
    const resVal = store.resolveValue(path, value);
    if (path === 'user.age') {
      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤–æ–∑—Ä–∞—Å—Ç –æ—Ç 0 –¥–æ 99:
      const clamped = Math.max(0, Math.min(99, resVal));
      next(path, clamped);
    } else {
      next(path, value);
    }
  };
};

// –¢–µ–ø–µ—Ä—å –ø—Ä–∏ store.update("user.age", 150) —Ä–µ–∞–ª—å–Ω–æ –ø–æ–ø–∞–¥—ë—Ç 99.
```

---

### 3. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è

–ï—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ middleware **–Ω–µ –≤—ã–∑–≤–∞—Ç—å** `next(path, value)`, –≤–µ—Å—å –¥–∞–ª—å–Ω–µ–π—à–∏–π –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ `update` ¬´–≥–ª–æ—Ö–Ω–µ—Ç¬ª ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è, –∞ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ middleware –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è.

```ts
const blockAgeMiddleware: Middleware<typeof initialState> = (store, next) => {
  return (path, value) => {
    if (path === 'user.age') {
      console.warn('[Middleware] –ò–∑–º–µ–Ω–µ–Ω–∏–µ user.age –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ');
      // –ù–µ –≤—ã–∑—ã–≤–∞–µ–º next ‚Üí –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–µ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç
      return;
    }
    next(path, value);
  };
};

// –ü—Ä–æ–±—É–µ–º:
store.update('user.age', 40);
// –õ–æ–≥: [Middleware] –ò–∑–º–µ–Ω–µ–Ω–∏–µ user.age –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
// –í–æ–∑—Ä–∞—Å—Ç –æ—Å—Ç–∞—ë—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º

store.update('user.name', 'Bob');
// –ü—Ä–æ—Ö–æ–¥–∏—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –¥–ª—è "user.name" –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è next.
```

---

### 4. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö middleware

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Ç–æ—Ä–∞ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –º–∞—Å—Å–∏–≤ middleware, –Ω–∞–ø—Ä–∏–º–µ—Ä: `[mw1, mw2, mw3]`. –ü–æ—Ä—è–¥–æ–∫ –≤—ã–∑–æ–≤–∞ (–ø–æ—Å–ª–µ —Ä–µ–≤–µ—Ä—Å–∞) —Ç–∞–∫–æ–≤:

1. mw1 ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç mw2
2. mw2 ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç mw3
3. mw3 ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç ¬´—è–¥—Ä–æ¬ª update

–ï—Å–ª–∏ –Ω–∞ –∫–∞–∫–æ–º-—Ç–æ —ç—Ç–∞–ø–µ `next` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –¥–∞–ª—å–Ω–µ–π—à–∏–µ middleware –∏ —Å–∞–º–æ —è–¥—Ä–æ –Ω–µ –ø–æ–ª—É—á–∞—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –∏ —Å—Ç–æ—Ä –Ω–µ –æ–±–Ω–æ–≤–∏—Ç—Å—è.

```ts
const mw1: Middleware<typeof initialState> = (store, next) => {
  return (path, value) => {
    const resVal = store.resolveValue(path, value);
    const resPath = store.resolvePath(path);

    console.log('[MW1] –î–æ', path, resPath, resVal);
    next(path, value);
    console.log('[MW1] –ü–æ—Å–ª–µ', path, store.get(path), resPath);
  };
};

const mw2: Middleware<typeof initialState> = (store, next) => {
  return (path, value) => {
    const resPath = store.resolvePath(path);

    console.log('[MW2] –ü—Ä–æ–≤–µ—Ä—è–µ–º', path);
    if (resPath === 'items.0') {
      console.log('[MW2] –ë–ª–æ–∫–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ items.0');
      return; // mw3 –∏ —è–¥—Ä–æ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è
    }
    next(path, value);
  };
};

const mw3: Middleware<typeof initialState> = (store, next) => {
  return (path, value) => {
    console.log('[MW3] –õ–æ–≥–∏–∫–∞ MW3');
    next(path, value);
  };
};

const store = createObservableStore(initialState, [mw1, mw2, mw3]);

// –ü—Ä–∏–º–µ—Ä:
store.update('items.0', 999);
// –õ–æ–≥:
// [MW1] –î–æ items.0 999
// [MW2] –ü—Ä–æ–≤–µ—Ä—è–µ–º items.0
// [MW2] –ë–ª–æ–∫–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ items.0
// ‚Üí mw1 –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –ø–æ—Å–ª–µ next, mw3 –Ω–µ –≤—ã–∑–æ–≤–µ—Ç—Å—è, update –Ω–µ –ø—Ä–∏–º–µ–Ω–∏—Ç—Å—è.

store.update('user.name', 'Dmitry');
// –õ–æ–≥:
// [MW1] –î–æ user.name Dmitry
// [MW2] –ü—Ä–æ–≤–µ—Ä—è–µ–º user.name
// [MW3] –õ–æ–≥–∏–∫–∞ MW3
// [MW1] –ü–æ—Å–ª–µ user.name Dmitry
// ‚Üí –ó–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ.
```

---

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç `DepthPath` –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω

`DepthPath` —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–º, –Ω–∞—Å–∫–æ–ª—å–∫–æ –≥–ª—É–±–æ–∫–æ TypeScript –±—É–¥–µ—Ç "—Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å" –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–∞, —á—Ç–æ–±—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –ø—É—Ç–∏ –≤–∏–¥–∞ `"user.settings.locale"`, `"items.0"` –∏ —Ç. –¥.

```
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å—Ç–æ–∏—Ç `DepthPath=0`.
```

---

#### ‚úÖ `DepthPath = 0`

- **–¢–∏–ø—ã –ø—É—Ç–µ–π –Ω–µ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –≤–æ–æ–±—â–µ.**
- –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤ –ø—É—Ç–µ–π (`SafePaths`, `PathExtract`, `PathOrAccessor`) —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∑–∞–≥–ª—É—à–∫–∞–º–∏.
- –ó–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –ø–æ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º —Å—Ç—Ä–æ–∫–∞–º, –Ω–æ:

  - ‚ùå **–∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç–∞ –Ω–µ—Ç**,
  - ‚ùå **—Ç–∏–ø–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Ç–µ–π –∏ –∑–Ω–∞—á–µ–Ω–∏–π –æ—Ç–∫–ª—é—á–µ–Ω–∞**,
  - ‚úÖ –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–æ–±–Ω–æ –¥–ª—è –º–æ–∫–æ–≤, —Ç–µ—Å—Ç–æ–≤, –∏–ª–∏ —Å–≤–æ–±–æ–¥–Ω–æ–π —Ä–∞–±–æ—Ç—ã –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

#### ‚ö†Ô∏è `DepthPath = 14` –∏ –≤—ã—à–µ

- ‚ö†Ô∏è **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –º–µ–¥–ª–µ–Ω–Ω–æ**: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è union-—Ç–∏–ø–æ–≤ –ø—É—Ç–µ–π —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π.
- ‚úÖ –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –≥–ª—É–±–æ–∫–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–º –ø—É—Ç—è–º, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å.
- ‚ùå –ù–æ –º–æ–∂–µ—Ç:

  - –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ **–∑–∞–º–µ–¥–ª–µ–Ω–∏—é –∏–ª–∏ –∑–∞–≤–∏—Å–∞–Ω–∏—é TypeScript/IDE (VSCode)**,
  - –≤—ã–∑–≤–∞—Ç—å **–æ—à–∏–±–∫–∏ "Type instantiation is excessively deep..."** –ø—Ä–∏ —Å–ª–æ–∂–Ω—ã—Ö —Ç–∏–ø–∞—Ö.

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:**

> –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `DepthPath > 10`, **–µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ —ç—Ç–æ –Ω–µ –æ–ø—Ä–∞–≤–¥–∞–Ω–æ —Ä–µ–∞–ª—å–Ω–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏.**

### –ò—Ç–æ–≥

| `DepthPath` | –ü–æ–≤–µ–¥–µ–Ω–∏–µ                                                               |
| ----------- | ----------------------------------------------------------------------- |
| `0`         | –ó–∞–≥–ª—É—à–∫–∞: –ª—é–±—ã–µ —Å—Ç—Ä–æ–∫–∏, –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç–∞                     |
| `1‚Äì7`       | –û–ø—Ç–∏–º–∞–ª—å–Ω–æ: –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø—É—Ç–∏, —Ä–∞–∑—É–º–Ω–∞—è –≥–ª—É–±–∏–Ω–∞                           |
| `8‚Äì13`      | –î–æ–ø—É—Å—Ç–∏–º–æ, –Ω–æ —É–∂–µ –º–æ–∂–µ—Ç —Ç–æ—Ä–º–æ–∑–∏—Ç—å IDE                                   |
| `14+`       | –†–∏—Å–∫ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞, –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –±–µ–∑ –∫—Ä–∞–π–Ω–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ |

---

## –ß—Ç–æ —Ç–∞–∫–æ–µ `Accessor` –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω

`Accessor<T, R>` ‚Äî —ç—Ç–æ **–º–∞–≥–∏—á–µ—Å–∫–∞—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è**, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `store`, –æ—Å–æ–±–µ–Ω–Ω–æ –∫–æ–≥–¥–∞ –ø—É—Ç—å –∫ –¥–∞–Ω–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∏—Ç **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é —á–∞—Å—Ç—å** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–Ω–¥–µ–∫—Å –º–∞—Å—Å–∏–≤–∞ –∏–ª–∏ ID).

---

### –°–∏–≥–Ω–∞—Ç—É—Ä–∞

```ts
export type Accessor<T, R = any> = ($: T, t: <K>(arg: K) => K) => R;
```

- `$` ‚Äî —Å–∞–º `store` (–µ–≥–æ `proxy`-–≤–µ—Ä—Å–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä `store.$`)
- `t(...)` ‚Äî —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π** –≤ –ø—É—Ç–∏

–ù–∞ –ø–µ—Ä–≤—ã–π –≤–∑–≥–ª—è–¥ –≤—ã–≥–ª—è–¥–∏—Ç —Å—Ç—Ä–∞–Ω–Ω–æ, –Ω–æ —Å—É—Ç—å –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–∞—è:

- –¢—ã –ø–∏—à–µ—à—å –æ–±—ã—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º, –∏—Å–ø–æ–ª—å–∑—É—è `store.$`, –Ω–∞–ø—Ä–∏–º–µ—Ä:

  ```ts
  store.$.items[2];
  ```

- –ê —Ç–µ–ø–µ—Ä—å –ø—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ `2` ‚Äî —ç—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `index`, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è:

  ```ts
  const accessor = ($, t) => $.items[t(index)];
  ```

üîÆ t(...) ‚Äî –ø—Ä–æ—Å—Ç–æ –æ–±—ë—Ä—Ç–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –≥–æ–≤–æ—Ä–∏—Ç —Å–∏—Å—Ç–µ–º–µ:

> ¬´–≠—Ç–∞ —á–∞—Å—Ç—å –ø—É—Ç–∏ ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è, –µ—ë –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ, –∞ –ø–æ—Ç–æ–º –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –≤ —Å—Ç—Ä–æ–∫—É.¬ª

---

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º

- `Accessor` –Ω–∏–∫–∞–∫ –Ω–µ –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é.
- –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ `store` –≤—ã–∑—ã–≤–∞–µ—Ç `toString()` –Ω–∞ `Accessor`, –∏ –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –≤—Ä–æ–¥–µ:

  ```ts
  'items.5';
  ```

- –≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ **–∞–Ω–∞–ª–∏–∑ —Ç–µ–ª–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Ä–µ–≥—É–ª—è—Ä–∫–∏**:

  - –í–Ω—É—Ç—Ä–∏ `t(index)` ‚Üí `5`
  - `$.items[t(index)]` –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ `"items.5"`

> üí° –≠—Ç–æ –æ—á–µ–Ω—å –ª—ë–≥–∫–∏–π —Å–ø–æ—Å–æ–± –≤—ã—Ä–∞–∑–∏—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—É—Ç–∏ **–±–µ–∑ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∏–ª–ª–∏–æ–Ω–æ–≤ —Ç–∏–ø–æ–≤ –∏ union'–æ–≤**, —á—Ç–æ –¥–µ–ª–∞–µ—Ç —Ä–∞–±–æ—Ç—É –≤ VSCode –±—ã—Å—Ç—Ä–æ–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π.

---

### –ü—Ä–∏–º–µ—Ä—ã

```ts
const index = 1;

store.update(($, t) => $.items[t(index)], 999);
// –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ: store.update("items.1", 999)
```

```ts
store.get(($, t) => $.user.settings[t('locale')]);
// –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ: store.get("user.settings.locale")
```

```ts
store.subscribeToPath(
  ($, t) => $.items[t(dynamicIndex)],
  (val) => {
    console.log('–ò–∑–º–µ–Ω–∏–ª—Å—è —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞:', val);
  }
);
```

---

### –ü–æ—á–µ–º—É —ç—Ç–æ –ª—É—á—à–µ, —á–µ–º `store.update("items." + index, ...)`

- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–∏–ø–∞–º–∏ (`PathExtract`, `AssertValidPath`)
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π —Å–∫–ª–µ–π–∫–∏ —Å—Ç—Ä–æ–∫
- ‚úÖ –ù–µ –Ω–∞–≥—Ä—É–∂–∞–µ—Ç IDE (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö `union`-—Ç–∏–ø–æ–≤)

---

## ‚ö†Ô∏è –ù–∞ –∑–∞–º–µ—Ç–∫—É

- –§—É–Ω–∫—Ü–∏—è `Accessor` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –∫–∞–∫ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ –∏ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞**, –æ–Ω–∞ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç `store.$` —Ä–µ–∞–ª—å–Ω–æ.
- –ù–µ —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –≤–Ω—É—Ç—Ä–∏ –Ω–µ—ë ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ `t(...)`.

---

## –ß—Ç–æ —Ç–∞–∫–æ–µ `CacheKeys` –∏ –∑–∞—á–µ–º –æ–Ω–∏ –Ω—É–∂–µ–Ω

`cacheKeys` ‚Äî —ç—Ç–æ **—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `store`**, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞–≤–∞—Ç—å **–∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø—É—Ç–∏ –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∏**, –≤ —Ç–æ–º —á–∏—Å–ª–µ —Å **–∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∏ —Ç–∏–ø–æ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é**.

---

### –î–ª—è —á–µ–≥–æ —ç—Ç–æ –Ω—É–∂–Ω–æ

–ò–Ω–æ–≥–¥–∞ –Ω–∞–º –Ω—É–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å, **–∫–∞–∫–∏–µ —á–∞—Å—Ç–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–æ–∂–Ω–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å, –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–∏**, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –æ–Ω–∏ **—Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏** –∏–ª–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –ª–æ–≥–∏–∫–∏.

–í —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞—è—Ö –Ω–∞ –ø–æ–º–æ—â—å –ø—Ä–∏—Ö–æ–¥–∏—Ç `cacheKeys` ‚Äî –æ–±—ä–µ–∫—Ç, –≤ –∫–æ—Ç–æ—Ä–æ–º –º—ã –æ–ø–∏—Å—ã–≤–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ "–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ" –ø—É—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç:

- ‚úÖ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å **–∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ**
- ‚úÖ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –º–µ—Ç–æ–¥–∞–º–∏ `store.invalidate(...)`, `store.subscribeToPath(...)` –∏ –¥—Ä.
- ‚úÖ –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è **—Ç–∏–ø–∞–º–∏** –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏

---

### –ü—Ä–∏–º–µ—Ä

```ts
interface StoreState {
  items: number[];
  counter: number;
  cacheKeys?: {
    'lol.items': number[]; // <- –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø—É—Ç—å
  };
}

const initialState = {
  items: [1, 2, 3],
  counter: 0,
};

export const store = createObservableStore<StoreState>(initialState, []);
```

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—É—Ç—å `"cacheKeys.lol.items.0"` –≤ –º–µ—Ç–æ–¥–∞—Ö:

```ts
store.invalidate('cacheKeys.lol.items.0');
```

> ‚òùÔ∏è –≠—Ç–æ –ø—É—Ç—å –Ω–µ –∫ —Ä–µ–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º, –∞ –∫ **–≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º—É –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—é**, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏ –≤ `cacheKeys`.

---

### –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ

–î–æ–±–∞–≤–∏–≤ –∫–ª—é—á –≤ `cacheKeys`, –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ:

- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫—É –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Å—Ç—Ä–æ–∫–∞—Ö –ø—É—Ç–µ–π
- ‚úÖ –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º (–µ—Å–ª–∏ —ç—Ç–æ –º–∞—Å—Å–∏–≤)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –º–µ—Ç–æ–¥–∞–º–∏ `invalidate`, `subscribeToPath`, `get` –∏ –¥—Ä.

---

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º

- `cacheKeys` ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –ø–æ–ª–µ –≤ —Ç–∏–ø–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ **–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω–æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ `initialState`**.
- –û–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ç–∏–ø–∞ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø—É—Ç–µ–π**.
- –í—ã –º–æ–∂–µ—Ç–µ –∑–∞–¥–∞–≤–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏ –º–∞—Å—Å–∏–≤—ã, —á—Ç–æ–±—ã IDE –∏ —Ç–∏–ø—ã –º–æ–≥–ª–∏ "–ø–æ–Ω—è—Ç—å", —á—Ç–æ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ —Å—Ç—Ä–æ–∫–æ–≤–æ–º—É –ø—É—Ç–∏.

---

### –ü—Ä–∏–º–µ—Ä —Å –ø–æ–¥–ø–∏—Å–∫–æ–π

```ts
store.subscribeToPath('cacheKeys.lol.items.2', (val) => {
  console.log('–≠–ª–µ–º–µ–Ω—Ç lol.items[2] –∏–∑–º–µ–Ω–∏–ª—Å—è:', val);
});
```

---

### –ó–∞—á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `cacheKeys`, –µ—Å–ª–∏ –º–æ–∂–Ω–æ –Ω–∞–ø—Ä—è–º—É—é

```ts
store.invalidate('lol.items.0'); // ‚ùå –ú–æ–∂–µ—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –∏–ª–∏ –Ω–µ –∏–º–µ—Ç—å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è
```

**–í–º–µ—Å—Ç–æ:**

```ts
store.invalidate('cacheKeys.lol.items.0');
```

`cacheKeys` –ø–æ–∑–≤–æ–ª—è–µ—Ç:

- ‚úÖ –Ø–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å, –∫–∞–∫–∏–µ –∫–ª—é—á–∏ **–∏–º–µ—é—Ç —Å–º—ã—Å–ª**
- ‚úÖ –°–¥–µ–ª–∞—Ç—å —Å–∏—Å—Ç–µ–º—É **—Ä–∞—Å—à–∏—Ä—è–µ–º–æ–π –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–π**
- ‚úÖ –ò–∑–±–µ–∂–∞—Ç—å –º–∞–≥–∏–∏ –∏ –±–∞–≥–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å "–ø–ª–∞–≤–∞—é—â–∏–º–∏" —Å—Ç—Ä–æ–∫–∞–º–∏

---

## ‚ö†Ô∏è –ù–∞ –∑–∞–º–µ—Ç–∫—É

- `cacheKeys` ‚Äî **–∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —Ç–∏–ø–æ–≤–∞—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è**, –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –≤ `initialState`
- –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ `cacheKeys` –Ω–µ—Ç –≤ runtime, **–≥–ª–∞–≤–Ω–æ–µ ‚Äî —á—Ç–æ–±—ã –æ–Ω–∞ –±—ã–ª–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ `StoreState`**
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–º–µ—Å—Ç–µ —Å `Accessor`, –µ—Å–ª–∏ –ø—É—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π:

```ts
const idx = 1;
store.invalidate((t) => store.$['cacheKeys'].lol.items[t(idx)]);
```

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–∞–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

1. **–§—Ä–µ–π–º–≤–æ—Ä–∫-–∞–≥–Ω–æ—Å—Ç–∏—á–Ω–æ—Å—Ç—å**

   - –Ø–¥—Ä–æ —Å—Ç–æ—Ä–∞ –Ω–∞–ø–∏—Å–∞–Ω–æ ¬´—á–∏—Å—Ç–æ¬ª –Ω–∞ TypeScript, –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç React/Vue/Svelte.
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –∞–¥–∞–ø—Ç–µ—Ä (—Ö—É–∫ –∏–ª–∏ –ø–ª–∞–≥–∏–Ω), –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ü–µ–ø–ª—è—Ç—å—Å—è –∫ `store.subscribeToPath` –∏ –¥–∏—Å–ø–∞—Ç—á–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI.

2. **–¢–æ—á–Ω–∞—è –≥—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–æ–∫**

   - –ü–æ–¥–ø–∏—Å–∫–∏ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ —Å—Ç—Ä–æ–∫–æ–≤–æ–º—É –ø—É—Ç–∏ –∏–ª–∏ —á–µ—Ä–µ–∑ Accessor<T>, –≥–¥–µ –≤–Ω—É—Ç—Ä–∏ Accessor –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `t(‚Ä¶)` –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–µ–∫—Å–æ–≤.
   - –ü–æ–¥–ø–∏—Å—á–∏–∫–∏ –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –ø–æ —Ç–µ–º –ø–æ–ª—è–º, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω–∏ –ø–æ–¥–ø–∏—Å–∞–Ω—ã.

3. **Middleware –∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã**

   - –ú–æ–∂–Ω–æ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ –æ–ø–∏—Å–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏/–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏/—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–π –¥–æ –∏—Ö –∑–∞–ø–∏—Å–∏.
   - –ö–∞–∂–¥—ã–π middleware –º–æ–∂–µ—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `value` –∏–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–º–µ–Ω–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ.

4. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞**

   - `asyncUpdate` —Å –æ–ø—Ü–∏–µ–π `abortPrevious` –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç–ª–µ–≥–∞–Ω—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —Å–µ—Ç—å—é, –æ—Ç–º–µ–Ω—è—è –ø—Ä–µ–∂–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã, –µ—Å–ª–∏ –æ–Ω–∏ –±–æ–ª—å—à–µ –Ω–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã.

5. **–ò—Å—Ç–æ—Ä–∏—è, undo/redo**

   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É—Ç–∏. –£–¥–æ–±–Ω–æ –≤ UI –¥–ª—è –∫–Ω–æ–ø–æ–∫ ¬´–æ—Ç–º–µ–Ω–∏—Ç—å¬ª/¬´–≤–µ—Ä–Ω—É—Ç—å¬ª.

6. **Batching**

   - –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π, —á—Ç–æ–±—ã –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –ø–æ–ª—É—á–∏–ª–∏ –µ–¥–∏–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –∏ UI –Ω–µ –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–≤–∞–ª—Å—è –ø–æ –∫–∞–∂–¥–æ–º—É –º–µ–ª–∫–æ–º—É –∏–∑–º–µ–Ω–µ–Ω–∏—é.

7. **–ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ TypeScript**

   - –¢–∏–ø `Accessor<T> = (t: (arg: any) => any) => T` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –ø—É—Ç—è–º–∏.
   - –í—ã–∑–æ–≤—ã `store.get` –∏ `store.update` —Å Accessor‚Äô–æ–º –ø–æ–∑–≤–æ–ª—è—é—Ç —Ç–æ—á–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω—É–∂–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ –±–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥–∞ —Å—Ç—Ä–æ–∫.

---

## –í—ã–≤–æ–¥

- **ObservableStore** ‚Äî —ç—Ç–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π —Å—Ç–æ—Ä, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ –æ—Å–Ω–æ–≤–µ JavaScript Proxy, Accessor<T> –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π, granular –ø–æ–¥–ø–∏—Å–æ–∫ –∏ —Ü–µ–ø–æ—á–µ–∫ middleware.
- –ë–ª–∞–≥–æ–¥–∞—Ä—è ¬´—á–∏—Å—Ç–æ–º—É¬ª —è–¥—Ä—É, –Ω–∞–ø–∏—Å–∞–Ω–Ω–æ–º—É –Ω–∞ TypeScript, –µ–≥–æ –º–æ–∂–Ω–æ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ–¥–∫–ª—é—á–∞—Ç—å –≤ React, Vue 3, Svelte, Solid –∏ –¥—Ä—É–≥–∏–µ —Å—Ä–µ–¥—ã: –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –ª—ë–≥–∫–∏–µ –∞–¥–∞–ø—Ç–µ—Ä—ã –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ –∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞.
- **–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**:

  1. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π —á–µ—Ä–µ–∑ `Accessor<T>`, –≥–¥–µ –≤–Ω—É—Ç—Ä–∏ –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å `t(index)` –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞.
  2. –ì—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ —Ç–æ—á–µ—á–Ω–æ–º—É –ø—É—Ç–∏ –∏–ª–∏ Accessor‚Äô—É.
  3. Middleware –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
  4. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å –æ—Ç–º–µ–Ω–æ–π –ø—Ä–æ—à–ª—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (`asyncUpdate`).
  5. –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (undo/redo) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É—Ç–∏.
  6. –ë—ç—á–∏–Ω–≥ (`batch`) –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–µ–Ω –ª—ë–≥–∫–∏–π, –±—ã—Å—Ç—Ä–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–π, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≥–∏–±–∫–∏–π —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π —Å—Ç–æ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö Accessor‚Äô–æ–≤, –∏–∑–ª–æ–∂–µ–Ω–Ω—ã–π **ObservableStore** –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç –≤—Å–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã ¬´–∏–∑ –∫–æ—Ä–æ–±–∫–∏¬ª.
