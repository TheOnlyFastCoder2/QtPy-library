# ‚öõÔ∏è createObservableStore: —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π —Å—Ç–æ—Ä —Å granular –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –∏ –∏–¥–µ–∞–ª—å–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å React

`createObservableStore` ‚Äî —ç—Ç–æ –ø—Ä–æ–¥—É–º–∞–Ω–Ω–∞—è –∏ –≥–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º, –∫–æ—Ç–æ—Ä–∞—è —Å–æ—á–µ—Ç–∞–µ—Ç —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —É–¥–æ–±–Ω—É—é —Ä–∞–±–æ—Ç—É —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏. –ë–ª–∞–≥–æ–¥–∞—Ä—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏ —É–¥–æ–±–Ω–æ–π –æ–±—ë—Ä—Ç–∫–µ –¥–ª—è React, –æ–Ω–∞ –ø–æ–º–æ–≥–∞–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å UI —Å —Ç–æ—á–Ω—ã–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —à–∞–±–ª–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ –∏ –≤—ã—Å–æ–∫–æ–π –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å—é.

–î–≤–∞ –ø–∞–∫–µ—Ç–∞ –¥–æ–ø–æ–ª–Ω—è—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞:

- [`@qtpy/state-management-observable`](https://www.npmjs.com/package/@qtpy/state-management-observable) ‚Äî —è–¥—Ä–æ: —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π Proxy-—Å—Ç–æ—Ä
- [`@qtpy/state-management-react`](https://www.npmjs.com/package/@qtpy/state-management-react) ‚Äî –æ–±—ë—Ä—Ç–∫–∞ –¥–ª—è React —Å —Ö—É–∫–∞–º–∏

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–æ–π–¥—ë—Ç —Ç–µ–º, –∫—Ç–æ —Ü–µ–Ω–∏—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –∏ —Å—Ç—Ä–æ–≥—É—é —Ç–∏–ø–∏–∑–∞—Ü–∏—é ‚Äî –±–µ–∑ –∏–∑–ª–∏—à–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –≤ API.

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

–°–∏—Å—Ç–µ–º–∞ createObservableStore –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ —Å —É—á—ë—Ç–æ–º –∫—Ä—É–ø–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤, –≥–¥–µ –≤–∞–∂–Ω–æ –∏–∑–±–µ–≥–∞—Ç—å –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Ä–æ—Å—Ç–µ –∫–æ–¥–∞. –ë–ª–∞–≥–æ–¥–∞—Ä—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–º –ø—É—Ç—è–º —á–µ—Ä–µ–∑ DepthPath, —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–ª—É—á–∞—é—Ç:

- üö´ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ "–º–∞–≥–∏—á–µ—Å–∫–∏—Ö" —Å—Ç—Ä–æ–∫: –ø—É—Ç–∏ –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –∏–ª–∏ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏, —á—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–µ –æ—à–∏–±–∫–∏

- ü§ñ –ì–ª—É–±–æ–∫–æ–µ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ IDE: –ø—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ –ø—É—Ç–µ–π –¥–æ—Å—Ç—É–ø–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ —Å —É—á—ë—Ç–æ–º –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ –æ–±—ä–µ–∫—Ç–∞

- üõ†Ô∏è –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∏—Å–∫–∞ –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ: –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ä–∞–∑—É –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –∫–æ–º–ø–∏–ª—è—Ü–∏–∏, –∏—Å–∫–ª—é—á–∞—è "—Ç–∏—Ö–∏–µ" –±–∞–≥–∏

–≠—Ç–∏ –º–µ—Ö–∞–Ω–∏–∑–º—ã –¥–µ–ª–∞—é—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —É—Å—Ç–æ–π—á–∏–≤–æ–π –∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º–æ–π ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏ —Å—Ç–æ—Ä–∞ –Ω–∞ –º–æ–¥—É–ª–∏ –∏ —Ä–∞–±–æ—Ç–µ –≤ –∫–æ–º–∞–Ω–¥–µ.

–ö—Ä–æ–º–µ —Ç–æ–≥–æ, —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–ø—Ä—è–º—ã–µ –º—É—Ç–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è** ‚Äî –ª—é–±–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ `store.$`, –∏ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤ —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ –∏—Ö –ø—É—Ç—å –±—ã–ª –∑–∞—Ç—Ä–æ–Ω—É—Ç. –ù–∞–ø—Ä–∏–º–µ—Ä:

```tsx
userStore.useEffect(["user.age"], ([age]) => {
  console.log("–í–æ–∑—Ä–∞—Å—Ç –æ–±–Ω–æ–≤–∏–ª—Å—è:", age);
  userStore.$.user.name = "qtpy"; // ‚Üí –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π –Ω–∞ 'user.name', –±—É–¥–µ—Ç –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω
});
```

–¢–∞–∫–∞—è –º–æ–¥–µ–ª—å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **—Ç–æ—á–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Ä–µ–Ω–¥–µ—Ä–∞–º–∏**: –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å, –±–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –∏–ª–∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

## üì¶ –ß–∞—Å—Ç—å 1: `@qtpy/state-management-observable`

–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π —Å—Ç–æ—Ä, –Ω–µ –∑–∞–≤–∏—Å—è—â–∏–π –æ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞. –í –µ—ë –æ—Å–Ω–æ–≤–µ –ª–µ–∂–∏—Ç –æ–±—ë—Ä—Ç–∫–∞ Proxy, –∫–æ—Ç–æ—Ä–∞—è —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω—É—é —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ store.$, –ø–æ–∑–≤–æ–ª—è—è –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –ª—é–±—ã–µ —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏, –≤–∫–ª—é—á–∞—è –∫–æ—Å–≤–µ–Ω–Ω—ã–µ –º—É—Ç–∞—Ü–∏–∏ –º–∞—Å—Å–∏–≤–æ–≤ —á–µ—Ä–µ–∑ —Ç–∞–∫–∏–µ –º–µ—Ç–æ–¥—ã, –∫–∞–∫ push, splice, sort –∏ –¥—Ä—É–≥–∏–µ. –í—Å—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –≤–æ–∫—Ä—É–≥ —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥–ø–∏—Å–æ–∫, –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–π –Ω–∞ Map: –ø–æ–¥–ø–∏—Å–∫–∏ –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç—Å—è –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –ø—É—Ç—è–º (—Å—Ç—Ä–æ–∫–æ–≤—ã–º –∏–ª–∏ Accessor-—Ñ—É–Ω–∫—Ü–∏—è–º), –∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞—Å—Å—ã–ª–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö, —á—Ç–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ snapshot-—Ö—ç—à–µ–π –¥–æ –∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è. –¢–∞–∫–æ–π –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –ª–∏—à–Ω–∏—Ö –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–æ–≤ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

```ts
import { createObservableStore } from "@qtpy/state-management-observable";

interface User {
  name: string;
  age: number;
}

interface AppState {
  user: User;
  items: number[];
  theme: string;
}
const initialState: AppState = {
  user: { name: "Alice", age: 30 },
  items: [1, 2, 3],
  theme: "light",
};
type DepthPath = 2;
const store = createObservableStore<AppState, DepthPath>(initialState, [], {
  customLimitsHistory: ($) => [
    ["user.age", 5],
    [(t) => $.items[t(1)], 3],
  ],
});

// –¢–æ—á–µ—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞
store.subscribeToPath("user.age", (newAge) => {
  console.log("–í–æ–∑—Ä–∞—Å—Ç –∏–∑–º–µ–Ω–∏–ª—Å—è:", newAge);
});

// –¢–∏—Ö–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
store.update("user.age", 35, { keepQuiet: true });

// –ò—Å—Ç–æ—Ä–∏—è
store.undo("user.age");
store.redo("user.age");
```

### üß© –†–∞–±–æ—Ç–∞ —Å –º–∞—Å—Å–∏–≤–∞–º–∏

–í `createObservableStore` —Ä–∞–±–æ—Ç–∞ —Å –º–∞—Å—Å–∏–≤–∞–º–∏ —É—Å—Ç—Ä–æ–µ–Ω–∞ —Ç–∞–∫, —á—Ç–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è snapshot –¥–æ –∏ –ø–æ—Å–ª–µ –º—É—Ç–∞—Ü–∏–∏. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ö–µ—à–µ–π —ç—Ç–∏—Ö snapshot‚Äô–æ–≤ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –±—ã–ª–æ –ª–∏ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å ‚Äî —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ—á–µ—á–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º.

- ‚úÖ **–ü–µ—Ä–µ–¥ –º—É—Ç–∞—Ü–∏–µ–π** —Å–æ–∑–¥–∞—ë—Ç—Å—è snapshot
- ‚úÖ **–ü–æ—Å–ª–µ –º—É—Ç–∞—Ü–∏–∏** ‚Äî –Ω–æ–≤—ã–π snapshot
- ‚úÖ **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ö–µ—à–µ–π** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç ‚Äî –±—ã–ª–æ –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ

–ü—Ä–∏–º–µ—Ä—ã:

```ts
store.$.items.push(2323); // ‚Üí –≤—ã–∑–æ–≤ –ø–æ–¥–ø–∏—Å–∫–∏
store.$.items[2] = 42; // ‚Üí —Ç–æ—á–µ—á–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

store.update("items", (prev) => {
  prev.push(99);
  return prev;
});

store.update("items", (prev) => prev); // ‚Üí –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ—Ç ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–µ—Ç
```

### üß∞ –ü–æ–ª–Ω—ã–π API

| –ú–µ—Ç–æ–¥                        | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                               |
| ---------------------------- | ---------------------------------------- |
| `get(path)`                  | –ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —Å—Ç—Ä–æ–∫–µ –∏–ª–∏ Accessor |
| `update(path, value, opts?)` | –û–±–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ                        |
| `subscribe(callback, keys?)` | –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞                      |
| `subscribeToPath(path, cb)`  | –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø–æ–ª–µ              |
| `batch(callback)`            | –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è                   |
| `asyncUpdate(...)`           | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ                   |
| `cancelAsyncUpdates(path?)`  | –û—Ç–º–µ–Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π              |
| `undo(path)` / `redo(path)`  | –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π                        |

## ‚öõÔ∏è –ß–∞—Å—Ç—å 2: `@qtpy/state-management-react`

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è `ObservableStore` –≤ React —á–µ—Ä–µ–∑ `createReactStore`. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∞–±–æ—Ä —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Ö—É–∫–æ–≤ —Å granular –ø–æ–¥–ø–∏—Å–∫–∞–º–∏, —Ç–∏—Ö–∏–º–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –∏ –æ—Ç–º–µ–Ω–æ–π —Ä–µ–Ω–¥–µ—Ä–æ–≤.

### ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

| –•—É–∫ / –ú–µ—Ç–æ–¥               | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                      |
| ------------------------- | ----------------------------------------------- |
| `useStore(paths)`         | –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –º–∞—Å—Å–∏–≤ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ –ø—É—Ç—è–º            |
| `useField(path)`          | `[value, setValue]` —Å `setValue.quiet()`        |
| `useEffect(paths, fn)`    | –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ –ø—É—Ç–∏    |
| `reloadComponents(paths)` | –§–æ—Ä—Å–∏—Ä—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø–æ `cacheKeys` |

### ‚öôÔ∏è –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ `createReactStore` –≤ React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Ç–æ—á–Ω–æ —Ç–∞–∫ –∂–µ, –∫–∞–∫ –∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å `createObservableStore`. –û–±–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –≤–∫–ª—é—á–∞—è –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, depth-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –ø–æ–¥—Ö–æ–¥–∞ –∏ –ª—ë–≥–∫—É—é –º–∏–≥—Ä–∞—Ü–∏—é –º–µ–∂–¥—É –æ–±—ë—Ä—Ç–∫–∞–º–∏, –ø–æ–∑–≤–æ–ª—è—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–∫—Ç–∏–≤–Ω—É—é –º–æ–¥–µ–ª—å –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏–ª–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

```ts
import { createReactStore } from "@qtpy/state-management-react";

const userStore = createReactStore(initialState, [], {
  customLimitsHistory: ($) => [
    ["user.age", 5],
    [(t) => $.items[t(1)], 3],
  ],
});
```

### üß™ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä: UserCard

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç `UserCard` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏–º—è –∏ –≤–æ–∑—Ä–∞—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ userStore. –û–Ω –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ `user.age` –∏ –ø—Ä–∏ –µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–µ—Ç –∏–º—è. –¢–∞–∫–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ–∑—Ä–∞—Å—Ç–∞, –æ—Ç–º–µ–Ω—ã/–ø–æ–≤—Ç–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏–π –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ ‚Äî –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—è —Ç–æ—á–µ—á–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å –ø–æ–º–æ—â—å—é `createReactStore`.

```tsx
import { userStore } from "./store";

export const UserCard = () => {
  const [name, setName] = userStore.useField("user.name");
  const [age, setAge] = userStore.useField("user.age");

  // –†–µ–∞–∫—Ü–∏—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
  userStore.useEffect(["user.age"], ([age]) => {
    console.log("–í–æ–∑—Ä–∞—Å—Ç –æ–±–Ω–æ–≤–∏–ª—Å—è:", age);
    userStore.$.user.name = "qtpy";
  });

  return (
    <div>
      <h2>{name}</h2>
      <p>–í–æ–∑—Ä–∞—Å—Ç: {age}</p>
      <button onClick={() => setAge((cur) => cur + 1)}>+</button>
      <button onClick={() => userStore.undo("user.age")}>Undo</button>
      <button onClick={() => userStore.redo("user.age")}>Redo</button>
      <button onClick={() => userStore.reloadComponents(["user.age"])}>
        reload
      </button>
    </div>
  );
};
```

### üîï –¢–∏—Ö–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–µ–Ω–¥–µ—Ä–∞

–í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –≤—ã–∑–æ–≤–∞ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –≤–Ω–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ª–æ–≥–∏–∫–µ. –î–ª—è —ç—Ç–æ–≥–æ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º "—Ç–∏—Ö–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π" —á–µ—Ä–µ–∑ `setTheme.quiet()`. –¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø–æ–º–æ–≥–∞–µ—Ç —Å–Ω–∏–∑–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ UI –∏ –ø–æ–≤—ã—Å–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–∏ —ç—Ç–æ–º —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º.

```tsx
const [theme, setTheme] = store.useField("theme");
setTheme.quiet("dark"); // –¢–∏—Ö–æ –∏–∑–º–µ–Ω–∏–ª–∏ —Ç–µ–º—É
```

## üéÆ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∫–µ–π—Å: –ò–≥—Ä–∞ ¬´15-–ø—è—Ç–Ω–∞—à–µ–∫¬ª

–≠—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ `createReactStore` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ granular-–ø–æ–¥–ø–∏—Å–∫–∏ –∏ —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ, –Ω–æ –∏ –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö. –í –∏–≥—Ä–µ –∫–∞–∂–¥–∞—è –ø–ª–∏—Ç–∫–∞ (`Tile`) –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞ `board[row][col]`, –∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –ª–∏—à—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—è. –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è ‚Äî —Å–¥–≤–∏–≥–∏, –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–±–µ–¥—ã, —Å—á—ë—Ç—á–∏–∫ —Ö–æ–¥–æ–≤ ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ `batch`, `update` –∏ `undo`, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –ª–æ–≥–∏–∫—É –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–π.

- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: `useStore([(t) => $.board[t(row)][t(col)]])`
- –†–µ–∞–∫—Ü–∏—è –Ω–∞ —Ñ–ª–∞–≥ —Ä–µ—à–µ–Ω–∏—è: `useField(() => $.isSolved)`
- –†–∞–±–æ—Ç–∞ —Å `batch()` –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã —á–µ—Ä–µ–∑ `checkSolved()` –∏ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `isSolved`

üß© –ö–æ–¥ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–∑–±–∏—Ç—ã –Ω–∞ –º–æ–¥—É–ª–∏ (`store.ts`, `Tile.tsx`, `PuzzleGame.tsx`) ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –ø–æ–¥ –¥—Ä—É–≥–∏–µ –∏–≥—Ä—ã.

üëâ [–û–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –ø—Ä–∏–º–µ—Ä–æ–º –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](https://www.npmjs.com/package/@qtpy/state-management-react#3-%D1%80%D0%B5%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F-%D0%B8%D0%B3%D1%80%D1%8B-15-puzzle)

## üöÄ –í—ã–≤–æ–¥

**_createObservableStore_** ‚Äî —ç—Ç–æ —Ä–µ–∞–∫—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è:

- üîç –≥—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—å - –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–≤–æ–π—Å—Ç–≤–∞
- üîÑ –ö–æ–Ω—Ç—Ä–æ–ª—å –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –æ—Ç–º–µ–Ω—ã
- üß† –ü–æ–ª–Ω–∞—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤ TypeScript
- ‚öõÔ∏è –ß–∏—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ React —Å —É–¥–æ–±–Ω—ã–º–∏ —Ö—É–∫–∞–º–∏

–ú–µ–Ω—å—à–µ —à–∞–±–ª–æ–Ω–æ–≤ ‚Äî –±–æ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–µ–µ –∏ –ø—Ä–∏—è—Ç–Ω–µ–µ.
